"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[81700],{378085:function(t,e,i){i.d(e,{$:function(){return a}});var s=i(552322),r=i(913649),n=i(788028),o=i(850358);let a=()=>{let{PRODUCT_NAME:t}=(0,o.ZR)();return(0,s.jsx)(r.Z,{size:n.default.spacing.sm,type:"full",alt:t})};a.displayName="AppHeaderLogo"},681700:function(t,e,i){var s=i(552322),r=i(202784),n=i(342670),o=i(225237),a=i.n(o),h=i(205632),l=i.n(h),d=i(348206),u=i(183351),p=i(718895),c=i(614549),m=i(140995),y=i(186261),f=i(268206),g=i(92044),S=i(290293),b=i(826750),w=i(422721),P=i(307411),I=i(164334),Z=i(6921),C=i(497872),v=i(293786),x=i(902183),D=i(368667),E=i(798396),T=i(518273),M=i(904845),j=i(477065),L=i(644865),U=i(349153),A=i(378085),_=i(368041),O=i(677350),$=i(408106);let k=()=>{let t=(0,h.useRouter)();return(0,s.jsx)(u.Z,{message:(0,s.jsx)(n.Z,{id:t.pathname.includes("/templates")?"page.editTemplate.loading":"page.edit.loading"})})},B=a()(()=>Promise.all([i.e(16253),i.e(50480),i.e(60783),i.e(3592),i.e(66816),i.e(9850),i.e(55601),i.e(88004),i.e(73282),i.e(57909),i.e(12589),i.e(59754),i.e(43163),i.e(6014),i.e(86521),i.e(2712),i.e(6528),i.e(98202),i.e(3210),i.e(18460),i.e(75173),i.e(54098),i.e(44954),i.e(11170),i.e(57707),i.e(52282),i.e(18999)]).then(i.bind(i,6978)),{loadableGenerated:{webpack:()=>[6978]},loading:k,ssr:!1}),R=a()(()=>i.e(56749).then(i.bind(i,156749)),{loadableGenerated:{webpack:()=>[156749]},loading:k,ssr:!1});class F extends r.Component{static #t=this.requiresAuthentication=!0;static async getInitialProps(t,e){let{id:i}=t.query,{config:s,locale:r}=e;if("string"!=typeof i)return(0,T.q)({ctx:t,signInUrl:e.signInUrl,config:s}),{};if(!(0,C.J)(i))throw new p.Z({type:"story-inaccessible",itemType:v.o.Story});let n=v.o.Story;try{let t=await (0,d.rV)(i,{authentication:e.authManager});if(n=(0,x.HL)(t)??n,"update"!==t.itemControl&&"admin"!==t.itemControl)throw new p.Z({type:"story-privileges-edit",itemType:n})}catch(t){if(t instanceof p.Z)throw new p.Z(t);throw Error(t)}return{config:s,locale:r,id:i,key:`${i}${t.query.duplicatePhase||"noDup"}`,itemType:n}}constructor(t){super(t),this.componentDidMount=async()=>{this.props.query?.duplicatePhase&&l().replace(`/${this.itemRouteModifier}/edit?id=${this.props.id}`,`${this.props.config.BASE_URL}/${this.itemRouteModifier}/${this.props.id}/edit`,{shallow:!0}),(0,c.Mq)(this.props.locale);try{await this.fetchStoryData()}catch(t){this.setState(()=>{if(t instanceof p.Z)throw new p.Z(t);throw Error(t)})}},this.renderOtherAuthorAvatarImage=t=>(0,s.jsx)(O.Z,{authManager:this.storyItem.authManager,user:t}),this.initializeStoryItem=()=>{this.storyItem=new m.ZP({type:this.props.itemType,authManager:this.props.authManager,version:"draft",getStoryMapUserPrivileges:()=>this.props.storyMapUserPrivileges,viewerMode:"builder",config:this.props.config}),this.storyItem.itemId=this.props.id||this.props.query?.id},this.fetchStoryData=async()=>{try{await this.storyItem.fetchStoryBuilderData(),(0,D.ZX)(this.storyItem.itemDetails)&&await this.onDuplicateStoryDetected(),(0,x.bk)(this.storyItem.itemDetails)&&this.storyItem.getItemPublishStatus()===E.PC.published&&this.onPublishStart(),this.setState({isItemDataLoaded:!0})}catch(t){if(t instanceof y.z){this.setState({fetchError:t});return}if(t instanceof p.Z&&"distributed-collab-no-draft"===t.type)(0,M.j)({href:`/${this.itemRouteModifier}/${this.storyItem.itemDetails.id}`,asPath:`${this.props.config.BASE_URL}/${this.itemRouteModifier}/${this.storyItem.itemDetails.id}`});else if(t instanceof p.Z)throw new p.Z(t);else throw Error(t)}},this.onPublishStart=async t=>{this.onPublishOrShareStart(t),this.setState({isPublishing:!0})},this.onShareStart=t=>{this.onPublishOrShareStart({sharingLevel:t}),this.setState({isSharing:!0})},this.onPublishOrShareStart=t=>{let e=t?.sharingLevel;e&&"string"==typeof e.access&&(this.storyItem.itemSharingLevel=e)},this.onPublishAndShareClose=()=>{this.setState({isPublishing:!1,isSharing:!1})},this.onPublishAndShareFinish=async()=>{if(this.state.isPublishing){window.scrollTo(0,0);let t=`/${this.itemRouteModifier}/view?id=${this.storyItem.itemId}`;l().push(t,`${this.props.config.BASE_URL}/${this.itemRouteModifier}/${this.storyItem.itemId}`)}else this.onPublishAndShareClose()},this.onStoryRendered=()=>{this.setState({isRendered:!0})},this.onDuplicateStart=()=>{this.setState({duplicatePhase:"duplicate"})},this.onDuplicateEnd=()=>{this.setState({duplicatePhase:void 0})},this.onDuplicateStoryDetected=()=>new Promise(t=>{this.setState({duplicatePhase:"cleanup"},t)}),this.onDiscardUnpublishedStart=()=>{this.setState({isItemDataLoaded:!1,isDiscardingUnpublishedChanges:!0})},this.onDiscardUnpublishedEnd=()=>{this.setState({isDiscardingUnpublishedChanges:!1})},this.onDiscardUnpublishedError=()=>{this.setState({isItemDataLoaded:!0,isDiscardingUnpublishedChanges:!1})},this.onUnpublishStart=()=>{this.setState({isUnpublishingStory:!0})},this.onUnpublishEnd=()=>{this.setState({isUnpublishingStory:!1})},this.cancelKeyDown=t=>t.preventDefault(),this.state={isPublishing:!1,isSharing:!1,duplicatePhase:this.props.query?.duplicatePhase,isItemDataLoaded:!1,isRendered:!1,isDiscardingUnpublishedChanges:!1,isUnpublishingStory:!1},this.initializeStoryItem()}render(){return(0,s.jsxs)(f.C,{areLabFeaturesEnabled:this.props.config.ENABLE_LAB_FEATURES&&this.props.query?.areLabFeaturesEnabled==="true",storyItem:this.storyItem,children:[this.state.fetchError?(0,s.jsx)(R,{itemType:this.props.itemType,error:this.state.fetchError}):(0,s.jsx)(I.Z,{}),this.state.isItemDataLoaded&&"cleanup"!==this.state.duplicatePhase&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(B,{...this.props,itemType:this.props.itemType,storyItem:this.storyItem,onStoryRendered:this.onStoryRendered,onPublish:this.onPublishStart,onShareItem:this.onShareStart,onDuplicateStoryClicked:this.onDuplicateStart,onDiscardUnpublishedClicked:this.onDiscardUnpublishedStart,onUnpublishClicked:this.onUnpublishStart,redirectOnLoadError:T.q,avatar:(0,s.jsx)(_.Z,{isThemed:!1}),appLogo:(0,s.jsx)(A.$,{}),feedbackMenu:(0,s.jsx)($.Z,{})}),(0,s.jsx)(Z.Z,{triggerKey:["z"],isCtrl:!0,isMeta:!0,on:this.cancelKeyDown}),(0,s.jsx)(Z.Z,{triggerKey:"y",isCtrl:!0,on:this.cancelKeyDown}),(0,s.jsx)(j.Z,{itemId:this.storyItem.itemId,itemType:this.props.itemType,isTemplate:this.storyItem.isTemplate,itemMode:"draft"})]}),(this.state.isPublishing||this.state.isSharing)&&(0,s.jsx)(g.Z,{onFinish:this.onPublishAndShareFinish,onClose:this.onPublishAndShareClose,storyItem:this.storyItem,mode:this.state.isPublishing?"publishing":"sharing",itemType:this.props.itemType}),this.state.duplicatePhase&&(0,s.jsx)(S.Z,{phase:this.state.duplicatePhase,storyItem:this.state.isItemDataLoaded?this.storyItem:void 0,onFinish:this.onDuplicateEnd,onClose:this.onDuplicateEnd,itemType:this.props.itemType}),this.state.isDiscardingUnpublishedChanges&&(0,s.jsx)(b.Z,{fetchStoryData:this.fetchStoryData,storyItem:this.storyItem,onFinish:this.onDiscardUnpublishedEnd,onClose:this.onDiscardUnpublishedError,itemType:this.props.itemType}),this.state.isUnpublishingStory&&(0,s.jsx)(w.Z,{storyItem:this.storyItem,onFinish:this.onUnpublishEnd,onClose:this.onUnpublishEnd,itemType:this.props.itemType}),this.storyItem&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(L.Z,{storyItem:this.storyItem,itemType:this.props.itemType,renderOtherAuthorAvatarImage:this.renderOtherAuthorAvatarImage}),this.storyItem.itemDetails&&(0,s.jsx)(U.Z,{storyType:this.props.itemType,storyItem:this.storyItem})]})]})}get itemRouteModifier(){return(0,P.N)(this.props.itemType,this.storyItem.isTemplate)}}e.Z=F},268206:function(t,e,i){i.d(e,{C:function(){return d}});var s=i(552322),r=i(134585),n=i(980860),o=i(150459),a=i(202784),h=i(969124);class l extends a.PureComponent{constructor(t){super(t),this.updateStoryOffsetContext=(t,e)=>{e?this.setState({...t,updateStoryOffsetContext:this.updateStoryOffsetContext}):this.setState(e=>({...e,...t,updateStoryOffsetContext:this.updateStoryOffsetContext}))},this.state={updateStoryOffsetContext:this.updateStoryOffsetContext,storyOffset:{navBarHeight:"0rem"}}}render(){return(0,s.jsx)(h.B.Provider,{value:this.state,children:this.props.children})}}function d(t){let{areLabFeaturesEnabled:e=!1,children:i,storyItem:a}=t;return(0,s.jsx)(r.HO,{areLabFeaturesEnabled:e,children:(0,s.jsx)(n.M2,{storyItem:a,children:(0,s.jsx)(l,{children:(0,s.jsx)(o.b,{children:i})})})})}},56867:function(t,e,i){i.d(e,{Od:function(){return n}}),i(552322);var s=i(202784);let r=(0,s.createContext)({translateContentIntoLocale:()=>void 0,submitTranslationFeedback:()=>void 0,allSupportedLanguages:[]}),n=()=>(0,s.useContext)(r)},969124:function(t,e,i){i.d(e,{B:function(){return s}});let s=(0,i(202784).createContext)({updateStoryOffsetContext:()=>{},storyOffset:{navBarHeight:"0rem"}})},614549:function(t,e,i){i.d(e,{Db:function(){return m},Mq:function(){return p},NH:function(){return c},Yx:function(){return f},kE:function(){return y},kz:function(){return u}});var s=i(552322),r=i(202784),n=i(69378),o=i(355125),a=i(81052),h=i(850358),l=i(580279),d=i(56867);let u=t=>t.nodes[t.root]?.config?.storyLocale,p=async t=>{{let{setLocale:e}=await Promise.all([i.e(72325),i.e(21154),i.e(4516)]).then(i.bind(i,504516));e(t??window.document.documentElement.lang??"en")}},c=async(t,e)=>{let i=e||window?.document?.documentElement?.lang||"en-us",s=`${(0,a.Zl)(t)}/portals/regions?f=json&culture=${i}`;return await (0,n.WY)(s)},m=t=>t.map((t,e)=>({id:e,labelId:"",label:t.localizedName,searchModifier:"",iSearchOptions:{categories:`/Region/${t.region}`}})),y=t=>{let{authManager:e}=(0,o.Pc)(),i=(0,h.ZR)(),{allSupportedLanguages:s}=(0,d.Od)(),[n,u]=(0,r.useState)(),p=(0,a.Zl)(i.PORTAL_HOST,e),c=(0,r.useMemo)(()=>{let e=t?.supportedLocales?.map(t=>l.dA(t,s))??[];return new Set(e)},[t?.supportedLocales,s]);return(0,r.useEffect)(()=>{(async()=>{if(p)try{let t=await (0,l.hN)(p);u(t)}catch(t){console.error(t)}})()},[p]),(0,r.useMemo)(()=>n?c.size?n.filter(t=>{let e=(0,l.dA)(t.culture,s);return c.has(e)}):n:void 0,[n,c,s])},f=(t,e)=>i=>{let r=y(e);return(0,s.jsx)(t,{portalLanguages:r,...i})}},134585:function(t,e,i){i.d(e,{HO:function(){return a},JH:function(){return h},Pn:function(){return o}});var s=i(552322),r=i(202784);let n=(0,r.createContext)({areLabFeaturesEnabled:!1}),o=()=>(0,r.useContext)(n).areLabFeaturesEnabled,a=t=>{let{children:e,areLabFeaturesEnabled:i}=t;return(0,s.jsx)(n.Provider,{value:{areLabFeaturesEnabled:i},children:e})},h=t=>e=>(0,s.jsx)(n.Consumer,{children:i=>(0,s.jsx)(t,{...e,...i})})},477065:function(t,e,i){var s=i(552322),r=i(202784),n=i(567523),o=i(6921),a=i(999354),h=i(293786);let l=()=>{a.Z.trackEvent(a.Z.Category.Viewer,a.Z.Action.Viewer_Print)},d=(0,r.memo)(t=>{let{routeTo:e,getUrlFromRouteDef:i}=(0,n.Gr)(),d=(0,r.useCallback)(s=>{if(t.itemType!==h.o.Story&&t.itemType!==h.o.Briefing)return;if(t.allowPrint){l();return}s?.preventDefault(),s&&a.Z.trackEvent({draft:a.Z.Category.Builder,published:a.Z.Category.Builder,preview:a.Z.Category.Builder}[t.itemMode],{draft:a.Z.Action.Builder_Print_Preview,published:a.Z.Action.Builder_Print_Preview,preview:a.Z.Action.Builder_Print_Preview}[t.itemMode],a.Z.Name.From_Keyboard);let r=(0,n.kN)({route:"print",printMode:t.itemMode,itemId:t.itemId,itemType:t.itemType,isTemplate:t.isTemplate});switch(t.itemMode){case"draft":e({method:"push",routeDef:r});return;case"published":case"preview":window.location.href=i(r);return;default:throw Error("invalid item mode")}},[e,i,t.itemId,t.allowPrint,t.itemMode,t.itemType,t.isTemplate]),u=(0,r.useCallback)(()=>{if(t.itemType===h.o.Story||t.itemType===h.o.Briefing){if(t.allowPrint){l();return}a.Z.trackEvent({draft:a.Z.Category.Builder,published:a.Z.Category.Viewer,preview:a.Z.Category.Viewer}[t.itemMode],{draft:a.Z.Action.Builder_Print_Preview,published:a.Z.Action.Viewer_Print_Preview,preview:a.Z.Action.Viewer_Print_Preview}[t.itemMode],a.Z.Name.From_Browser_Menu),d()}},[d,t.allowPrint,t.itemMode,t.itemType]);return(0,r.useEffect)(()=>(window.addEventListener("beforeprint",u),()=>{window.removeEventListener("beforeprint",u)}),[u]),(0,s.jsx)(o.Z,{triggerKey:"p",isCtrl:!0,isMeta:!0,on:d})});e.Z=d}}]);