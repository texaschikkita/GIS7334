import{r as y,S as Ee,j as e,C as me,M as Ft,R as Bt,U as ie,e as _e,a as tn,u as F,b as H,g as zt,c as Fe,d as ft,f as Oe,m as K,h as pt,i as Ye,k as ue,l as ge,s as le,n as ce,B as ht,o as mt,D as gt,p as De,q as $t,t as Be,v as yt,w as at,x as bt,y as qe,z as Ut,A as xt,E as Wt,T as Gt,P as nn,F as on,G as ze,H as rn,O as an,I as vt,J as oe,K as wt,L as sn,N as ln,Q as cn,V as dn,W as un,X as fn,Y as pn,Z as hn,_ as mn,$ as gn,a0 as yn,a1 as bn,a2 as xn,a3 as vn,a4 as wn,a5 as Sn}from"./client-4fcabb37.js";import{i as S,M as ae,C as je,S as St,p as st}from"./index-49f75067.js";import{_ as it,t as jn,D as jt,S as Cn,U as kn,a as En,M as On}from"./index-1e049a8b.js";function Ce(n,t){const[o,s]=y.useState(()=>{try{const i=window.localStorage.getItem(n);return i?JSON.parse(i):t}catch(i){return console.log(i),t}});return[o,i=>{try{const a=i instanceof Function?i(o):i;if(s(a),a.forever===!1)return;window.localStorage.setItem(n,JSON.stringify(a))}catch(a){console.log(a)}}]}function Dn(n){return n>64&&n<91?n-65:n>96&&n<123?n-71:n>47&&n<58?n+4:n===43?62:n===47?63:0}function _n(n,t){for(var o=n.replace(/[^A-Za-z0-9\+\/]/g,""),s=o.length,r=t?Math.ceil((s*3+1>>2)/t)*t:s*3+1>>2,i=new Uint8Array(r),a,l,u=0,c=0,d=0;d<s;d++)if(l=d&3,u|=Dn(o.charCodeAt(d))<<6*(3-l),l===3||s-d===1){for(a=0;a<3&&c<r;a++,c++)i[c]=u>>>(16>>>a&24)&255;u=0}return i}function Ie(n){return n<26?n+65:n<52?n+71:n<62?n-4:n===62?43:n===63?47:65}function Tn(n){for(var t=2,o="",s=n.length,r=0,i=0;i<s;i++)t=i%3,i>0&&i*4/3%76===0&&(o+=`\r
`),r|=n[i]<<(16>>>t&24),(t===2||n.length-i===1)&&(o+=String.fromCodePoint(Ie(r>>>18&63),Ie(r>>>12&63),Ie(r>>>6&63),Ie(r&63)),r=0);return o.substr(0,o.length-2+t)+(t===2?"":t===1?"=":"==")}function Mn(n){for(var t="",o,s=n.length,r=0;r<s;r++)o=n[r],t+=String.fromCodePoint(o>251&&o<254&&r+5<s?(o-252)*1073741824+(n[++r]-128<<24)+(n[++r]-128<<18)+(n[++r]-128<<12)+(n[++r]-128<<6)+n[++r]-128:o>247&&o<252&&r+4<s?(o-248<<24)+(n[++r]-128<<18)+(n[++r]-128<<12)+(n[++r]-128<<6)+n[++r]-128:o>239&&o<248&&r+3<s?(o-240<<18)+(n[++r]-128<<12)+(n[++r]-128<<6)+n[++r]-128:o>223&&o<240&&r+2<s?(o-224<<12)+(n[++r]-128<<6)+n[++r]-128:o>191&&o<224&&r+1<s?(o-192<<6)+n[++r]-128:o);return t}function Nn(n){for(var t,o,s=n.length,r=0,i=0;i<s;i++)o=n.codePointAt(i),o>65536&&i++,r+=o<128?1:o<2048?2:o<65536?3:o<2097152?4:o<67108864?5:6;t=new Uint8Array(r);for(var a=0,l=0;a<r;l++)o=n.codePointAt(l),o<128?t[a++]=o:o<2048?(t[a++]=192+(o>>>6),t[a++]=128+(o&63)):o<65536?(t[a++]=224+(o>>>12),t[a++]=128+(o>>>6&63),t[a++]=128+(o&63)):o<2097152?(t[a++]=240+(o>>>18),t[a++]=128+(o>>>12&63),t[a++]=128+(o>>>6&63),t[a++]=128+(o&63),l++):o<67108864?(t[a++]=248+(o>>>24),t[a++]=128+(o>>>18&63),t[a++]=128+(o>>>12&63),t[a++]=128+(o>>>6&63),t[a++]=128+(o&63),l++):(t[a++]=252+(o>>>30),t[a++]=128+(o>>>24&63),t[a++]=128+(o>>>18&63),t[a++]=128+(o>>>12&63),t[a++]=128+(o>>>6&63),t[a++]=128+(o&63),l++);return t}function An(n){return Tn(Nn(n))}function Pn(n){return Mn(_n(n))}function In(n){return An(n).replaceAll("/","_").replaceAll("+","-")}function Rn(n){const t=n.replaceAll("_","/").replaceAll("-","+").replaceAll(".","=");return Pn(t)}var R=(n=>(n[n.NORMAL=0]="NORMAL",n[n.SUNEXPOSURE=1]="SUNEXPOSURE",n[n.ANNUAL_EXPOSURE=2]="ANNUAL_EXPOSURE",n))(R||{});const Ln=()=>Ht().split(",").length>=2,Ht=()=>window.location.pathname.indexOf("@")!==-1?window.location.pathname.split("@")[1]:window.location.hash.replace("#",""),Fn=()=>{window.location.hash.indexOf("gpx=")!==-1?(window.shadeMap_gpxFile=window.location.hash.split("gpx=")[1],window.history.replaceState(null,null," ")):window.location.hash.indexOf("kml=")!==-1&&(window.shadeMap_gpxFile=window.location.hash.split("kml=")[1],window.history.replaceState(null,null," "))},Bn=()=>{window.location.hash.indexOf("dsm=")!==-1&&(window.shadeMap_dsmFile=window.location.hash.split("dsm=")[1],window.history.replaceState(null,null," "));const n=window.location.search,o=new URLSearchParams(n).get("dsm");o!==null&&(o.startsWith("https:")?window.shadeMap_dsmFile=o:window.shadeMap_dsmFile=new URL(`?t=${o}`,"https://shademap.app/dsm/").toString())},zn=async n=>{let{zoom:t,center:o,date:s,bearing:r,pitch:i,minZoom:a,mode:l,search:u}=n;if(Fn(),Bn(),Ln()){const d=Ht().split(",");if(d.length===2&&d[0]=="2m"&&d[1]=="0t"){l.mode=parseInt(d[0]);try{const{lat:b,lng:g}=window.CFLocation;b!==void 0&&g!==void 0&&(o={lat:b,lng:g},t=15)}catch{console.log("IP location lookup failed")}}if(d.length>=3&&(o={lat:parseFloat(d[0]),lng:parseFloat(d[1])},t=parseFloat(d[2].slice(0,-1))),d.length>=4){const b=parseInt(d[3].slice(0,-1),10);Number.isNaN(b)||(s=new Date(b))}if(d.length>=5&&(r=parseFloat(d[4])),d.length>=6&&(i=parseFloat(d[5])),d.length>=7){const g=d[6].split("!");if(l.mode=parseInt(g[0]),l.mode===1&&g.length===3){const f=parseInt(g[1]);Number.isNaN(f)||(l.startDate=new Date(f));const p=parseInt(g[2]);Number.isNaN(f)||(l.endDate=new Date(p))}else{const{sunrise:f,sunset:p}=Ee.getTimes(s,o.lat,o.lng);l.startDate=f,l.endDate=p}}if(d.length>=8){const b=d[7];if(d.indexOf("q",0)){const g=b.split("!");g.length===3&&(u={query:Rn(g[0].substring(1)),marker:{lat:parseFloat(g[1]),lng:parseFloat(g[2])}})}}}else try{const{lat:c,lng:d}=window.CFLocation;c!==void 0&&d!==void 0&&(o={lat:c,lng:d},t=15)}catch{console.log("IP location lookup failed")}return t=t<a?a:t,{zoom:t,center:o,date:s,bearing:r,pitch:i,mode:l,search:u}},ke=function(n){const{center:t,zoom:o,date:s,bearing:r,pitch:i,mode:a,search:l}=n,u=1e5,c=g=>Math.round(g*u)/u,d=[c(t.lat),c(t.lng),c(o)+"z",s.getTime()+"t",c(r)+"b",c(i)+"p",[a.mode+"m"].concat(a.startDate&&a.endDate?[a.startDate.getTime().toString(),a.endDate.getTime().toString()]:[]).join("!")];if(l){const{query:g,marker:f}=l;d.push(`q${In(g)}!${c(f.lat)}!${c(f.lng)}`)}const b="/@"+d.join(",");window.history.replaceState("","",b)},Ue=n=>{const{children:t}=n,[o,s]=y.useState(!1),r=o?{...n.style,...n.mobileStyle}:n.style,i=r&&r.top||"auto",a=r&&r.bottom||"auto";return y.useEffect(()=>{const l=()=>{s(window.innerWidth<=Ft)};return l(),window.addEventListener("resize",l),()=>{window.removeEventListener("resize",l)}},[]),e.jsx("div",{style:{...Ct.container,top:i,bottom:a},children:e.jsx("div",{style:{...Ct.inset,...r},children:t})})},Ct={container:{display:"flex",justifyContent:"center",alignItems:"center",position:"absolute",left:0,right:0,marginInline:"auto",overflow:"hidden"},inset:{backgroundColor:me.background,boxShadow:"2px 2px 8px rgba(0,0,0,0.2)",borderRadius:4,padding:10,color:"white",textAlign:"center",boxSizing:"border-box",lineHeight:"1.25em",fontSize:"1.5em"}},z=n=>{const{style:t,...o}=n;return e.jsx("button",{style:{...$n.button,...t},...o})},$n={button:{cursor:"pointer",borderRadius:4,borderWidth:2,borderColor:"rgba(0,0,0,0.2)",backgroundColor:"#ccc",paddingLeft:4,paddingRight:4,paddingTop:5,paddingBottom:5,fontSize:15,marginTop:5,color:"black"}},de=n=>{const{style:t,...o}=n;return e.jsx(z,{style:{...Un.primaryButton,...t},...o})},Un={primaryButton:{backgroundColor:me.accent,fontWeight:"bold",color:"white"}},Wn=n=>{const{updateOnboarded:t}=n,o=y.useRef(null),s=()=>{t({value:!0,forever:!1})},r=()=>{t({value:!0,forever:!0})};return y.useEffect(()=>{let i=1;const a=10;let l=-a;const u=setInterval(()=>{o.current!==null&&((l>a||l<-a)&&(i=-i),l=l+i,o.current.style.transform=`translateX(${l+10}px)`)},50);return()=>{clearInterval(u)}},[]),e.jsxs(Ue,{style:{width:220,zIndex:3,top:"auto",bottom:10},mobileStyle:{top:60,bottom:"auto"},children:[e.jsxs("div",{style:{overflow:"hidden",position:"relative",paddingBottom:10},children:[e.jsx("div",{style:{position:"absolute",top:0,left:"60%",borderLeft:"10px solid transparent",borderRight:"10px solid transparent",borderTop:`10px solid ${me.accent}`,zIndex:2}}),e.jsxs("div",{ref:o,style:{display:"flex",width:400},children:[[17,18,19,20,21].map(i=>{const a=new Date;return a.setHours(i),e.jsx("div",{style:{flex:1,borderLeft:"1px solid #eee",height:30,fontSize:"0.8em",fontWeight:"bold",lineHeight:"45px"},children:a.toLocaleTimeString([],{hour:"numeric"})},i)}),e.jsx("div",{style:{position:"absolute",top:0,left:-50,backgroundColor:"rgba(255, 255, 0, 0.7)",width:175,height:10}}),e.jsx("img",{style:Gn.cursor,src:"grabber.png",alt:"grabber icon"})]})]}),S("onboarding"),e.jsxs("div",{style:{display:"flex",gap:10,justifyContent:"center",paddingTop:5},children:[e.jsx(de,{style:{flexGrow:0,minWidth:50},onClick:s,children:S("ok")}),e.jsx(z,{onClick:r,style:{background:"none",color:"white",border:"none",flexGrow:1},children:S("dont.show.again")})]})]})},Gn={cursor:{position:"absolute",width:24,height:24,left:70,top:8}},Xt=document.createElement("div");document.body.append(Xt);const Hn=n=>{const{children:t,onClick:o}=n,s=e.jsxs(e.Fragment,{children:[e.jsx("div",{style:Xn.cover,onClick:o}),t]});return Bt.createPortal(s,Xt)},Xn={cover:{position:"fixed",top:0,left:0,right:0,bottom:0,zIndex:1001,backgroundColor:"rgba(0,0,0,0.5)"}},lt=n=>{const{style:t,...o}=n;return e.jsx("a",{style:{...Zn.button,...t},...o})},Zn={button:{textDecoration:"none",borderRadius:4,borderWidth:2,borderColor:"rgba(0,0,0,0.2)",backgroundColor:"#ccc",paddingTop:5,paddingBottom:5,fontSize:15,marginTop:5,color:"black"}},V=n=>{const{onClick:t,children:o,style:s}=n,r=i=>{i.stopPropagation()};return y.useEffect(()=>(document.body.style.overflow="hidden",()=>{document.body.style.overflow="auto"})),e.jsx(Hn,{onClick:t,children:e.jsxs("div",{style:{...Yn.modal,...s},onClick:r,children:[e.jsx("div",{style:{display:"flex",justifyContent:"flex-end",marginTop:-10,marginBottom:-20},children:e.jsx(lt,{title:"Close","aria-label":"Close",onClick:t,href:"#",style:{padding:5,backgroundColor:"white"},children:e.jsx(ae,{iconName:"close",color:"black"})})}),o]})})},Yn={modal:{zIndex:1001,backgroundColor:"white",maxWidth:600,width:"95%",position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",borderRadius:8,boxShadow:"0 2px 15px rgba(0,0,0,0.5)",padding:15,boxSizing:"border-box"}},qn=n=>{const{unit:t,updateUnit:o,style:s}=n,r=i=>{const a=i.target.value;a!==t&&o(a)};return e.jsxs("div",{style:s,children:[e.jsx("div",{style:{paddingBottom:3},children:"Display contour lines in:"}),e.jsxs("div",{children:[e.jsx("input",{type:"radio",name:"units",id:"unit_meters",value:ie.METERS,checked:t===ie.METERS,onClick:r,onChange:r}),e.jsx("label",{htmlFor:"unit_meters",style:{color:"inherit"},children:"meters"})]}),e.jsxs("div",{children:[e.jsx("input",{type:"radio",name:"units",id:"unit_feet",value:ie.FEET,checked:t===ie.FEET,onClick:r,onChange:r}),e.jsx("label",{htmlFor:"unit_feet",style:{color:"inherit"},children:"feet"})]})]})},Jn=n=>{const{style:t,setBelowCanopy:o,belowCanopy:s}=n,r=i=>{const a=i.target.value==="true";o(a)};return e.jsxs("div",{style:t,children:[e.jsxs("div",{style:{paddingBottom:3},children:[S("tree.shading"),":"]}),e.jsxs("div",{children:[e.jsx("input",{type:"radio",name:"tree_shading",id:"tree_shading_above",value:"false",checked:!s,onClick:r,onChange:r}),e.jsx("label",{htmlFor:"tree_shading_above",style:{color:"inherit"},children:S("top.of.canopy")})]}),e.jsxs("div",{children:[e.jsx("input",{type:"radio",name:"tree_shading",id:"tree_shading_below",value:"true",checked:s,onClick:r,onChange:r}),e.jsx("label",{htmlFor:"tree_shading_below",style:{color:"inherit"},children:S("below.canopy")})]})]})},Kn=_e.lazy(()=>it(()=>import("./ColorPickerControl-e331c9e5.js"),["assets/ColorPickerControl-e331c9e5.js","assets/client-4fcabb37.js","assets/client-b9e2e652.css","assets/index-49f75067.js","assets/index-1e049a8b.js","assets/index-225ddab7.css"])),Ge=({color:n})=>e.jsx("span",{style:{display:"inline-block",width:16,height:10,marginLeft:5,backgroundColor:n}}),Vn=navigator.language,Qn=Vn==="en-US",kt=n=>{const{sunDirectionOptions:t,setSunDirectionOptions:o,setBelowCanopy:s,belowCanopy:r,color:i,onColorChange:a,iterations:l,setIterations:u}=n,[c,d]=y.useState(!1),[b,g]=Ce(tn,Qn?ie.FEET:ie.METERS),[f,p]=y.useState(0),[v,x]=y.useState(l),m=()=>{c&&l!==v&&u(v),d(P=>!P),p(0)},C=()=>{o({...t,now:!t.now})},D=()=>{o({...t,sunrise:!t.sunrise})},h=()=>{o({...t,sunset:!t.sunset})},w=()=>{p(1)},O=P=>{g(P)},E=F();y.useEffect(()=>{const P=()=>{b===ie.METERS?E.getLayer("contour-label")&&E.setLayoutProperty("contour-label","text-field",["concat",["get","ele"]," m"]):E.getLayer("contour-label")&&E.setLayoutProperty("contour-label","text-field",["concat",["*",["get","ele"],3.3]," ft"])};return E.loaded()?P():E.once("idle",P),()=>{E.off("idle",P)}},[b,E]);let A;return f===0?A=e.jsxs(V,{onClick:m,style:{userSelect:"none"},children:[e.jsx("div",{style:{fontSize:20,fontWeight:"bold",paddingBottom:10},children:S("settings")}),e.jsxs("div",{style:He.spacer,children:[e.jsxs("div",{style:{paddingBottom:3},children:[S("sun.direction.lines"),":"]}),e.jsx("div",{children:e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",checked:t.now,onChange:C}),S("current.time"),e.jsx(Ge,{color:"gold"})]})}),e.jsx("div",{children:e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",checked:t.sunrise,onChange:D}),S("sunrise"),e.jsx(Ge,{color:"orange"})]})}),e.jsx("div",{children:e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",checked:t.sunset,onChange:h}),S("sunset"),e.jsx(Ge,{color:"orangered"})]})})]}),e.jsx(qn,{style:He.spacer,unit:b,updateUnit:O}),e.jsx(Jn,{style:He.spacer,belowCanopy:r,setBelowCanopy:s}),e.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[e.jsx("div",{style:{paddingRight:10},children:"Shade color"}),e.jsx("div",{onClick:w,style:{borderRadius:"50%",width:44,height:44,backgroundColor:`rgba(${i.r},${i.g},${i.b},${i.a}`,cursor:"pointer",boxShadow:"0 0 3px rgba(0,0,0,0.3)"}})]}),e.jsxs("div",{style:{display:"none"},children:[e.jsx("label",{children:"Exposure iterations"}),e.jsx("input",{type:"number",onChange:P=>{x(parseInt(P.target.value))},value:v})]})]}):f===1&&(A=e.jsxs(V,{onClick:m,style:{userSelect:"none"},children:[e.jsxs("div",{style:{fontSize:20,fontWeight:"bold",paddingBottom:10},children:[S("shade.color"),":"]}),e.jsx(y.Suspense,{fallback:e.jsxs("div",{children:[S("loading"),"..."]}),children:e.jsx(Kn,{color:i,onColorChange:a})})]})),e.jsxs(_e.Fragment,{children:[e.jsx("div",{className:`${H}-ctrl-group`,children:e.jsx("button",{"aria-label":S("settings"),"aria-disabled":"false",type:"button",onClick:m,children:e.jsx("span",{className:`${H}-ctrl-icon`,"aria-hidden":"true",title:S("settings"),style:{backgroundSize:20,backgroundImage:"url(//fonts.gstatic.com/s/i/short-term/release/materialsymbolsoutlined/settings/default/48px.svg)"}})})}),c?A:null]})},He={spacer:{paddingBottom:15}};var We={},eo=function(){var n=document.getSelection();if(!n.rangeCount)return function(){};for(var t=document.activeElement,o=[],s=0;s<n.rangeCount;s++)o.push(n.getRangeAt(s));switch(t.tagName.toUpperCase()){case"INPUT":case"TEXTAREA":t.blur();break;default:t=null;break}return n.removeAllRanges(),function(){n.type==="Caret"&&n.removeAllRanges(),n.rangeCount||o.forEach(function(r){n.addRange(r)}),t&&t.focus()}},to=eo,Et={"text/plain":"Text","text/html":"Url",default:"Text"},no="Copy to clipboard: #{key}, Enter";function oo(n){var t=(/mac os x/i.test(navigator.userAgent)?"⌘":"Ctrl")+"+C";return n.replace(/#{\s*key\s*}/g,t)}function ro(n,t){var o,s,r,i,a,l,u=!1;t||(t={}),o=t.debug||!1;try{r=to(),i=document.createRange(),a=document.getSelection(),l=document.createElement("span"),l.textContent=n,l.ariaHidden="true",l.style.all="unset",l.style.position="fixed",l.style.top=0,l.style.clip="rect(0, 0, 0, 0)",l.style.whiteSpace="pre",l.style.webkitUserSelect="text",l.style.MozUserSelect="text",l.style.msUserSelect="text",l.style.userSelect="text",l.addEventListener("copy",function(d){if(d.stopPropagation(),t.format)if(d.preventDefault(),typeof d.clipboardData>"u"){o&&console.warn("unable to use e.clipboardData"),o&&console.warn("trying IE specific stuff"),window.clipboardData.clearData();var b=Et[t.format]||Et.default;window.clipboardData.setData(b,n)}else d.clipboardData.clearData(),d.clipboardData.setData(t.format,n);t.onCopy&&(d.preventDefault(),t.onCopy(d.clipboardData))}),document.body.appendChild(l),i.selectNodeContents(l),a.addRange(i);var c=document.execCommand("copy");if(!c)throw new Error("copy command was unsuccessful");u=!0}catch(d){o&&console.error("unable to copy using execCommand: ",d),o&&console.warn("trying IE specific stuff");try{window.clipboardData.setData(t.format||"text",n),t.onCopy&&t.onCopy(window.clipboardData),u=!0}catch(b){o&&console.error("unable to copy using clipboardData: ",b),o&&console.error("falling back to prompt"),s=oo("message"in t?t.message:no),window.prompt(s,n)}}finally{a&&(typeof a.removeRange=="function"?a.removeRange(i):a.removeAllRanges()),l&&document.body.removeChild(l),r()}return u}var ao=ro;function Je(n){"@babel/helpers - typeof";return Je=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Je(n)}Object.defineProperty(We,"__esModule",{value:!0});We.CopyToClipboard=void 0;var Re=Zt(y),so=Zt(ao),io=["text","onCopy","options","children"];function Zt(n){return n&&n.__esModule?n:{default:n}}function Ot(n,t){var o=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);t&&(s=s.filter(function(r){return Object.getOwnPropertyDescriptor(n,r).enumerable})),o.push.apply(o,s)}return o}function Dt(n){for(var t=1;t<arguments.length;t++){var o=arguments[t]!=null?arguments[t]:{};t%2?Ot(Object(o),!0).forEach(function(s){ct(n,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(o)):Ot(Object(o)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(o,s))})}return n}function lo(n,t){if(n==null)return{};var o=co(n,t),s,r;if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);for(r=0;r<i.length;r++)s=i[r],!(t.indexOf(s)>=0)&&Object.prototype.propertyIsEnumerable.call(n,s)&&(o[s]=n[s])}return o}function co(n,t){if(n==null)return{};var o={},s=Object.keys(n),r,i;for(i=0;i<s.length;i++)r=s[i],!(t.indexOf(r)>=0)&&(o[r]=n[r]);return o}function uo(n,t){if(!(n instanceof t))throw new TypeError("Cannot call a class as a function")}function _t(n,t){for(var o=0;o<t.length;o++){var s=t[o];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(n,s.key,s)}}function fo(n,t,o){return t&&_t(n.prototype,t),o&&_t(n,o),Object.defineProperty(n,"prototype",{writable:!1}),n}function po(n,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");n.prototype=Object.create(t&&t.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),Object.defineProperty(n,"prototype",{writable:!1}),t&&Ke(n,t)}function Ke(n,t){return Ke=Object.setPrototypeOf||function(s,r){return s.__proto__=r,s},Ke(n,t)}function ho(n){var t=go();return function(){var s=$e(n),r;if(t){var i=$e(this).constructor;r=Reflect.construct(s,arguments,i)}else r=s.apply(this,arguments);return mo(this,r)}}function mo(n,t){if(t&&(Je(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Yt(n)}function Yt(n){if(n===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n}function go(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function $e(n){return $e=Object.setPrototypeOf?Object.getPrototypeOf:function(o){return o.__proto__||Object.getPrototypeOf(o)},$e(n)}function ct(n,t,o){return t in n?Object.defineProperty(n,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):n[t]=o,n}var qt=function(n){po(o,n);var t=ho(o);function o(){var s;uo(this,o);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return s=t.call.apply(t,[this].concat(i)),ct(Yt(s),"onClick",function(l){var u=s.props,c=u.text,d=u.onCopy,b=u.children,g=u.options,f=Re.default.Children.only(b),p=(0,so.default)(c,g);d&&d(c,p),f&&f.props&&typeof f.props.onClick=="function"&&f.props.onClick(l)}),s}return fo(o,[{key:"render",value:function(){var r=this.props;r.text,r.onCopy,r.options;var i=r.children,a=lo(r,io),l=Re.default.Children.only(i);return Re.default.cloneElement(l,Dt(Dt({},a),{},{onClick:this.onClick}))}}]),o}(Re.default.PureComponent);We.CopyToClipboard=qt;ct(qt,"defaultProps",{onCopy:void 0,options:void 0});var yo=We,Ve=yo.CopyToClipboard;Ve.CopyToClipboard=Ve;var bo=Ve;const xo=zt(bo),vo=()=>{const n=y.useRef(null),[t,o]=y.useState(window.location.href),[s,r]=y.useState(!1),[i,a]=y.useState(!1),l=async()=>{if(o(window.location.href),navigator.canShare&&navigator.canShare({url:window.location.href}))try{await navigator.share({url:window.location.href})}catch{}else a(d=>!d)},u=()=>{n.current&&n.current.select(),r(!0),setTimeout(()=>r(!1),1e3)},c=e.jsxs(V,{onClick:l,children:[e.jsxs("div",{style:{fontSize:20,fontWeight:"bold"},children:[S("share.this")," Shade Map"]}),e.jsxs("div",{style:{paddingTop:20,fontSize:16,color:"gray"},children:[S("link.to.share"),":"]}),e.jsx("input",{ref:n,style:{width:"100%",fontSize:15,lineHeight:"24px"},value:`${window.location.href}`,disabled:!0}),e.jsx(xo,{text:t,onCopy:u,children:e.jsx(z,{children:S("copy.link")})}),s?e.jsxs("span",{style:{paddingLeft:5},children:[S("copied"),"!"]}):null]});return e.jsxs(_e.Fragment,{children:[e.jsx("div",{className:`${H}-ctrl-group`,children:e.jsx("button",{"aria-label":S("share"),"aria-disabled":"false",type:"button",onClick:l,children:e.jsx("span",{className:`${H}-ctrl-icon`,"aria-hidden":"true",title:S("share"),style:{backgroundSize:20,backgroundImage:"url(//fonts.gstatic.com/s/i/short-term/release/materialsymbolsoutlined/ios_share/default/48px.svg)"}})})}),i?c:null]})},re="sun-direction",Xe=({center:n,points:t,color:o})=>({type:"Feature",properties:{color:o},geometry:{type:"LineString",coordinates:[n,t]}}),Tt=(n,t,o,s,r)=>{const i=n.getSource(re);if(!i)return;const{lat:a,lng:l}=t,{sunrise:u,sunset:c}=Oe(o,a,l,r),d=n.getBounds();if(d===null)return;const b=Math.abs(d.getWest()-l),g=Math.abs(l-d.getEast()),f=Math.abs(d.getNorth()-a),p=Math.abs(a-d.getSouth()),v=Math.min(Math.min(g,b),Math.min(f,p)),x=C=>{const{azimuth:D,altitude:h}=C,w=-Math.sin(D),O=-Math.cos(D),E=1-h/(Math.PI/2),A=.8;return[l+A*E*w*v,a+A*E*O*v]},m={type:"FeatureCollection",features:[]};if(s.sunrise){const C=Ee.getPosition(u,a,l);m.features.push(Xe({center:[l,a],points:x(C),color:"orange"}))}if(s.sunset){const C=Ee.getPosition(c,a,l);m.features.push(Xe({center:[l,a],points:x(C),color:"orangered"}))}if(s.now){const C=Ee.getPosition(o,a,l);m.features.push(Xe({center:[l,a],points:x(C),color:"gold"}))}i.setData(m)},wo=n=>{const{now:t,center:o,options:s,timeZone:r}=n,i=F();return y.useEffect(()=>((async()=>{await K(i),Fe(i,re),ft(i,re),i.addSource(re,{type:"geojson",data:{type:"FeatureCollection",features:[]}}),i.addLayer({id:re,source:re,type:"line",paint:{"line-color":["get","color"],"line-width":5,"line-opacity":.85}}),Tt(i,o,t,s,r)})(),()=>{try{Fe(i,re),ft(i,re)}catch{}}),[i]),y.useEffect(()=>{Tt(i,o,t,s,r)},[o,i,t,s,r]),null},So=n=>{const{startDate:t,endDate:o,onApply:s,timeZone:r}=n,[i,a]=y.useState(t),[l,u]=y.useState(o),c=h=>h.toLocaleTimeString("en-us",{hour:"2-digit",hour12:!1,minute:"2-digit",timeZone:r||void 0}),d=F(),b=(h,w)=>{const[O,E]=h.split(":"),[A,P]=w.split(":"),I=parseInt(O)-parseInt(A),j=parseInt(E)-parseInt(P);return I*60*60*1e3+j*60*1e3},g=h=>{const w=b(c(h),c(i));a(O=>new Date(O.getTime()+w))},f=h=>{const w=b(c(h),c(l));u(O=>new Date(O.getTime()+w))},p=()=>{const h=d.getCenter(),{sunrise:w}=Oe(i,h.lat,h.lng,r);a(w)},v=()=>{const h=d.getCenter(),{sunset:w}=Oe(i,h.lat,h.lng,r);u(w)},x=h=>{const w=h.target.value,O=b(w,c(i));a(E=>new Date(E.getTime()+O))},m=h=>{const w=h.target.value,O=b(w,c(l));u(E=>new Date(E.getTime()+O))},C=h=>{const w=c(i),O=c(l),E=new Date(`${h}T${w}${Ye(i,r)}`),A=new Date(`${h}T${O}${Ye(l,r)}`);a(E),u(A)},D=()=>{s({startDate:i,endDate:l})};return e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{fontSize:20,fontWeight:"bold",paddingBottom:10},children:"Select time range"}),e.jsx("div",{style:{marginBottom:20},children:e.jsxs("fieldset",{style:{display:"flex",gap:5,flexWrap:"wrap"},children:[e.jsx("legend",{children:"Date"}),e.jsx("input",{type:"date",value:pt(i,r),onChange:h=>C(h.target.value)}),e.jsx(z,{onClick:()=>C(pt(new Date,r)),children:"Today"}),e.jsx(z,{onClick:()=>C("2023-06-21"),children:new Date("2023/06/21").toLocaleDateString([],{month:"long",day:"numeric"})}),e.jsx(z,{onClick:()=>C("2023-12-21"),children:new Date("2023/12/21").toLocaleDateString([],{month:"long",day:"numeric"})}),e.jsx(z,{onClick:()=>C("2023-03-20"),children:"Equinox"})]})}),e.jsxs("div",{style:{display:"flex",gap:20,flexWrap:"wrap"},children:[e.jsxs("fieldset",{style:{display:"flex",gap:5},children:[e.jsx("legend",{children:"Start time"}),e.jsx("input",{type:"time",value:c(i),onChange:x}),e.jsx(z,{onClick:()=>g(new Date),children:"Now"}),e.jsx(z,{onClick:p,children:"Sunrise"})]}),e.jsxs("fieldset",{style:{display:"flex",gap:5},children:[e.jsx("legend",{children:"End time"}),e.jsx("input",{type:"time",value:c(l),onChange:m}),e.jsx(z,{onClick:()=>f(new Date),children:"Now"}),e.jsx(z,{onClick:v,children:"Sunset"})]})]}),e.jsxs("div",{style:{paddingTop:10},children:[e.jsx(z,{onClick:D,disabled:l.getTime()<=i.getTime(),children:"Apply"}),l.getTime()<=i.getTime()&&e.jsx("span",{style:{paddingLeft:10,color:"red",fontSize:"0.8em"},children:"End time must come after start time"})]})]})},jo=n=>{const{startDate:t,endDate:o,changeDates:s,timeZone:r}=n,[i,a]=y.useState(!1),l=F();y.useEffect(()=>{l.getContainer().style.height="calc(100% - 80px)",l.getContainer().style.flex="auto",l.resize()},[l]);const u=()=>{a(!0)},c=()=>{a(!1)},d=g=>{a(!1),s(g)},b=(o.getTime()-t.getTime())/1e3/3600;return e.jsxs("div",{style:fe.container,children:[e.jsxs("div",{style:fe.gradient,children:[e.jsx("div",{style:fe.unit,children:"0"}),e.jsx("div",{style:{...fe.unit,flexGrow:1},children:S("hours.in.the.sun")}),e.jsx("div",{style:fe.unit,children:Math.floor(b*10)/10})]}),e.jsx("div",{style:{display:"flex",gap:20},children:e.jsxs("div",{style:fe.lozenge,onClick:u,children:[e.jsx("span",{style:{paddingRight:20},children:t.toLocaleDateString([],{month:"short",day:"2-digit",timeZone:r||void 0})}),t.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",timeZone:r||void 0})," - ",o.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",timeZone:r||void 0})]})}),i&&e.jsxs(V,{onClick:c,children:[e.jsx(So,{...n,onApply:d})," "]})]})},fe={container:{position:"fixed",bottom:0,padding:"0 5px",backgroundColor:me.background,color:"white",fontSize:18,width:"100%",fontWeight:"bold",zIndex:1e3,display:"flex",flexDirection:"column",alignItems:"center",boxSizing:"border-box",justifyContent:"space-evenly",height:80},gradient:{backgroundColor:"white",backgroundImage:"linear-gradient(to right, rgb(0 0 255/ 0.5), rgb(0 255 0 / 0.5), rgb(255 0 0 / 0.5))",display:"flex",maxWidth:400,width:"100%",borderRadius:5,color:"black"},unit:{padding:5,flexGrow:0,textAlign:"center",fontWeight:"bold"},lozenge:{border:"1px solid white",padding:"3px 5px",borderRadius:3,cursor:"pointer",background:"url(/edit.svg) right center / 20px no-repeat",paddingRight:22,overflow:"hidden",textOverflow:"ellipsis",flexShrink:0}},Co=n=>{const{now:t,timeZone:o,mapMode:s}=n,r=F(),i=ue(),[a,l]=y.useState(r.getPitch()>0),[u,c]=y.useState(!1);y.useEffect(()=>{(async()=>{if(u||(await K(r),c(!0)),r.getPitch()===0||r.getZoom()<De||s.mode===R.SUNEXPOSURE)return;const g=r.getCenter(),{sunrise:f,sunset:p}=Oe(t,g.lat,g.lng,o);let v=t;t.getTime()<f.getTime()?v=f:t.getTime()>p.getTime()?v=p:Math.min(t.getTime()-f.getTime(),p.getTime()-t.getTime())/1e3/60;const x=Ee.getPosition(v,g.lat,g.lng),m=(x.azimuth+Math.PI)*360/(2*Math.PI),C=Math.min(90-x.altitude*360/(2*Math.PI),90);r.setLight({anchor:"map",position:[1.5,m,C]})})()},[t,r,o,a,u,s]);const d=()=>{a?r.easeTo({pitch:0,duration:500}):r.easeTo({pitch:45,duration:500})};return ge("pitchend",async()=>{await K(r),r.getPitch()>0&&!a?(le(r,ht),le(r,mt),le(r,gt),l(!0)):r.getPitch()===0&&(i.setDate(t),ce(r,ht),ce(r,mt),ce(r,gt),l(!1))}),e.jsx("div",{className:`${H}-ctrl-group`,children:e.jsx("button",{"aria-label":S("tilt.map"),"aria-disabled":"false",type:"button",onClick:d,children:a?"2D":e.jsx("span",{className:`${H}-ctrl-icon`,"aria-hidden":"true",title:S("tilt.map"),style:{backgroundSize:20,backgroundImage:"url(//fonts.gstatic.com/s/i/short-term/release/materialsymbolsoutlined/3d_rotation/default/48px.svg)"}})})})},ko=n=>{const{mode:t,date:o,timeZone:s}=n,r=t===R.NORMAL?"shade":"sun_exposure",i=o.toLocaleDateString("en-us",{year:"numeric",timeZone:s}),a=o.toLocaleDateString("en-us",{month:"2-digit",timeZone:s}),l=o.toLocaleDateString("en-us",{day:"2-digit",timeZone:s});let u=`${r}_${i}-${a}-${l}`;if(t===R.NORMAL){const c=o.toLocaleTimeString("en-us",{hour:"2-digit",hour12:!1,timeZone:s}),d=o.toLocaleTimeString("en-us",{minute:"2-digit",timeZone:s}),g=Ye(o,s).replace("+0","+").replace("-0","-").replace(":00","").replace(":","");u+=`T${c}.${d}.00.GMT${g}`}return`${u}.tiff`},Eo=n=>{const{mapMode:t,now:o,timeZone:s}=n,[r,i]=y.useState(!1),a=ue(),l=()=>{i(!1)},u=async()=>{const c=await it(()=>import("./geotiff-a99bbef9.js").then(E=>E.g),["assets/geotiff-a99bbef9.js","assets/client-4fcabb37.js","assets/client-b9e2e652.css","assets/index-1e049a8b.js","assets/index-225ddab7.css"]),d=a.toGeoTiff();if(d===null){alert("Could not export GeoTIFF. Please report the issue.");return}const{data:b,metadata:g}=d,{width:f,height:p,ModelTiepoint:v,ModelPixelScale:x}=g,m=await c.writeArrayBuffer(Array.from(b),{ImageWidth:f,ImageLength:p,BitsPerSample:[8],Compression:1,PhotometricInterpretation:1,StripOffsets:[1054],SamplesPerPixel:1,RowsPerStrip:[p],StripByteCounts:[f*p],PlanarConfiguration:1,SampleFormat:[1],ModelPixelScale:x,ModelTiepoint:v,GeoKeyDirectory:[1,1,0,5,1024,0,1,2,1025,0,1,1,2048,0,1,4326,2049,34737,7,0,2054,0,1,9102],GeoAsciiParams:"WGS 84",GTModelTypeGeoKey:2,GTRasterTypeGeoKey:1,GeographicTypeGeoKey:4326,GeogCitationGeoKey:"WGS 84"}),D=new Uint8Array(m).reduce((E,A)=>E+=String.fromCharCode(A),""),w=`data:image/tiff;base64,${btoa(D)}`,O=ko({mode:t.mode,date:t.mode===R.NORMAL?o:t.startDate||o,timeZone:s});$t({datauri:w,filename:O}),i(!0)};return e.jsxs("div",{className:`${H}-ctrl-group`,children:[e.jsx("button",{"aria-label":"Export as GeoTIFF","aria-disabled":"false",type:"button",onClick:u,children:e.jsx("span",{className:`${H}-ctrl-icon`,"aria-hidden":"true",title:"Export as GeoTIFF",style:{backgroundSize:20,backgroundImage:"url(//fonts.gstatic.com/s/i/short-term/release/materialsymbolsoutlined/file_save/default/48px.svg)"}})}),r&&e.jsxs(V,{onClick:l,children:[e.jsx("h2",{children:"Your download is finished"}),t.mode===R.NORMAL&&e.jsx("p",{children:"GeoTIFF values are 0 for shadow and 255 for sun"}),t.mode===R.SUNEXPOSURE&&e.jsx("p",{children:"Direct sun exposure GeoTIFF value range is 0-240. Multiply the value by 6 to compute total minutes of sun exposure. For example, 17 is 17 * 6 minutes = 102 minutes or 1 hour and 42 minutes."}),e.jsxs("p",{children:["If you need help or want to export a large data set, please"," ",e.jsx("a",{href:"https://us6.list-manage.com/contact-form?u=e5e17c9e245874654e775b644&form_id=271345c0ff1a17865f8194ec099c597f",target:"_blank",rel:"noreferrer noopener",children:"get in touch"}),"."]})]})]})},Se=n=>{const{children:t,selected:o,imageSrc:s,onClick:r}=n;return e.jsxs("button",{style:{display:"flex",alignItems:"center",width:"100%",height:56,background:"none",outline:"none",border:"none",cursor:"pointer",color:"black",backgroundColor:o?"#ededed":"inherit"},onClick:r,children:[e.jsx("div",{style:{margin:5,width:48,height:48,borderRadius:3,backgroundSize:"48px 48px",backgroundImage:`url(./${s}.jpg)`}}),e.jsx("div",{children:t})]})},dt=(navigator.userAgent.indexOf("Mobile")!==-1||navigator.userAgent.indexOf("iPhone")!==-1||navigator.userAgent.indexOf("Android")!==-1||navigator.userAgent.indexOf("Windows Phone")!==-1)&&window.innerWidth<=428,Oo=n=>{const{mapMode:t,setMapMode:o}=n,[s,r]=y.useState(!1),i=F(),[a,l]=y.useState(!1);y.useEffect(()=>{const g=()=>{r(!1)};return i.on("touchend",g),i.on("click",g),()=>{i.off("touchend",g),i.off("click",g)}},[i]);const u=g=>{o({mode:g}),b()},c=()=>{if(i.getLayoutProperty("satellite-layer","visibility")==="visible"){ce(i,"satellite-layer"),le(i,Be),le(i,"building-underground"),le(i,"contour-label");const f=i.getStyle();f&&f.layers&&f.layers.filter(v=>v.type==="line"||v.type==="fill"&&v["source-layer"]==="road").forEach(v=>{yt(i,v,!1)}),l(!1)}},d=()=>{if(i.getLayoutProperty("satellite-layer","visibility")!=="visible"){le(i,"satellite-layer"),ce(i,Be),ce(i,"building-underground"),ce(i,"contour-label");const f=i.getStyle();f&&f.layers&&f.layers.filter(v=>v.type==="line"||v.type==="fill"&&v["source-layer"]==="road").forEach(v=>{yt(i,v,!0)}),l(!0)}},b=()=>{r(g=>!g)};return e.jsxs(e.Fragment,{children:[s?e.jsxs("div",{style:{position:"absolute",backgroundColor:"#fff",bottom:t.mode===R.ANNUAL_EXPOSURE&&dt?-215:-98,right:40,width:175,borderRadius:4,boxShadow:"0 0 0 2px rgba(0,0,0,.1)",zIndex:2},children:[e.jsx("div",{style:{padding:8},children:"Data layer"}),e.jsx(Se,{onClick:()=>u(R.NORMAL),selected:t.mode===R.NORMAL,imageSrc:"layer-shadow",children:S("shadows")}),e.jsx(Se,{onClick:()=>u(R.SUNEXPOSURE),selected:t.mode===R.SUNEXPOSURE,imageSrc:"layer-hours-of-sun",children:S("hours.in.the.sun")}),e.jsx(Se,{onClick:()=>u(R.ANNUAL_EXPOSURE),selected:t.mode===R.ANNUAL_EXPOSURE,imageSrc:"layer-annual-sunlight",children:S("annual.sunlight")}),e.jsx("div",{style:{padding:8},children:"Basemap"}),e.jsx(Se,{onClick:c,selected:!a,imageSrc:"layer-map",children:S("outdoors")}),e.jsx(Se,{onClick:d,selected:a,imageSrc:"layer-satellite",children:S("satellite")})]}):null,e.jsx("div",{className:`${H}-ctrl-group`,children:e.jsx("button",{"aria-label":"Layers","aria-disabled":"false",type:"button",onClick:b,children:e.jsx("span",{className:`${H}-ctrl-icon`,"aria-hidden":"true",title:"Layers",style:{backgroundSize:20,backgroundImage:"url(//fonts.gstatic.com/s/i/short-term/release/materialsymbolsoutlined/layers/default/48px.svg)"}})})})]})},Do=n=>{const{file:t,setDsmFile:o,style:s}=n,r=ue(),i=F(),a=()=>{o(null)},l=()=>{const u=new at.LngLatBounds(r.options.dsmSource.bounds),[c,d]=[u.getNorthEast(),u.getSouthWest()];i.fitBounds([c,d],{animate:!1})};return e.jsx(Ue,{style:{width:340,maxWidth:340,top:"auto",bottom:8,...s},mobileStyle:{...s},children:e.jsxs("div",{style:{display:"flex",gap:10},children:[e.jsx("button",{style:Mt.linkButton,onClick:a,title:"Remove surface data","aria-label":"Remove surface data",children:e.jsx(ae,{color:"white",iconName:"close"})}),e.jsxs("div",{style:{fontSize:"0.8em",whiteSpace:"nowrap",textOverflow:"ellipsis",overflow:"hidden",textAlign:"left",flex:1},children:[dt?"":"Showing ",t.name]}),e.jsx("button",{style:Mt.linkButton,onClick:l,title:"Fit area on screen","aria-label":"Fit area on screen",children:e.jsx(ae,{color:"white",iconName:"fit_screen"})})]})})},Mt={linkButton:{background:"none",padding:0,border:"none",color:"white",fontWeight:"bold",cursor:"pointer",fontSize:".8em","--hover-opacity":.9,"--hover-scale":1.1}},Qe=new Date().getFullYear(),_o=new Uint8ClampedArray([0,0,0,255]),te=new Uint8ClampedArray([0,0,0,255]),To=n=>{const{profile:t}=n,{data:o,width:s,height:r}=t,[i,a]=y.useState(!1),l=F();y.useState(()=>{const d=()=>{window.innerWidth>600?a(!0):a(!1)};return window.addEventListener("resize",d),d(),()=>{window.removeEventListener("resize",d)}});const u=d=>{d.preventDefault();const b=[];for(let v=0;v<s;v++){let x=0;for(let m=0;m<r;m++){const C=m*s*4+v*4;o[C]===te[0]&&o[C+1]===te[1]&&o[C+2]===te[2]&&o[C+3]===te[3]||(x+=1)}b.push(x)}const g=JSON.stringify({description:`Each data array position corresponds to the day of the year 0-${s}. The array value corresponds to minutes of direct sunlight.`,position:{lng:l.getCenter().lng,lat:l.getCenter().lat},minutesOfDirectSunPerDay:b,minutesOfDirectSunPerYear:b.reduce((v,x)=>v+x,0)},null,2),f="data:text/json;charset=utf-8,"+encodeURIComponent(g),p=document.createElement("a");p.href=f,p.download="annual-sunlight.json",document.body.appendChild(p),p.click(),document.body.removeChild(p)};if(!i)return null;const c="url(//fonts.gstatic.com/s/i/short-term/release/materialsymbolsoutlined/download/default/48px.svg) center / 32px no-repeat";return e.jsx("a",{href:"",onClick:u,role:"button",title:"Download",children:e.jsx("div",{style:{backgroundColor:"white",mask:c,WebkitMask:c,width:32,height:32}})})},Mo=n=>{const{profile:t,timeZone:o}=n,s=ue(),r=y.useRef(null),i=y.useRef(null),a=y.useRef(null),l=y.useRef(null),[u,c]=y.useState(null),[d,b]=y.useState(0),[g,f]=y.useState(0);y.useEffect(()=>{if(r.current!==null){const D=r.current.getContext("2d");if(D!==null){D.imageSmoothingEnabled=!1,c(D);const h=r.current.getBoundingClientRect();x(h.x+h.width/2,h.y+h.height/2)}}},[]),y.useEffect(()=>{(async()=>{if(r.current===null||u===null)return;const h=t.data,w=t.height,O=t.width;if(t.width===0||t.height===0)return;let E=0,A=0;for(let M=0;M<h.length;M+=4)if(!(h[M]===te[0]&&h[M+1]===te[1]&&h[M+2]===te[2]&&h[M+3]===te[3])){E+=1;const U=bt({rgbArray:new Uint8Array([h[M],h[M+1],h[M+2]])});A+=.016666666666666666*(1.353*(.7*U))}b(E),f(A);const P=new ImageData(new Uint8ClampedArray(h.buffer),O,w),I=r.current,j=await createImageBitmap(P),X=I.getBoundingClientRect();I.width=X.width*devicePixelRatio,I.height=X.height*devicePixelRatio,u.drawImage(j,0,0,O,w,0,0,I.width,I.height);const $=I.height/24/2;u.font=`${$}px sans-serif`,u.fillStyle="#ccc",u.strokeStyle="#aaa",u.beginPath();for(let M=1;M<24;M++){const U=I.height/24;u.moveTo(0,U*M),u.lineTo(I.width,U*M)}for(let M=1;M<24;M++)u.fillText(M.toString(),3,I.height/24*(24-M)-10);let L=0;for(let M=1;M<=12;M++){const U=new Date(new Date().getFullYear(),M,0),q=U.getDate(),Y=U.toLocaleDateString([],{month:"short"});u.fillText(Y,L/t.width*I.width+10,I.height-10),L+=q,M!==12&&(u.moveTo(L/t.width*I.width,0),u.lineTo(L/t.width*I.width,I.height))}u.stroke()})()},[t,u]);const p=D=>{const h=D.touches[0].clientX,w=D.touches[0].clientY;x(h,w)},v=D=>{const h=D.clientX,w=D.clientY;x(h,w)},x=(D,h)=>{if(r.current===null)return;const w=r.current.getBoundingClientRect(),O=D-w.left,E=h-w.top;if(O<0||O>w.width||E<0||E>w.height)return;const A=Math.floor(O/w.width*t.width),P=Math.floor((1-E/w.height)*24*60),I=Math.floor(P/60),j=Math.floor(P%60),X=new Date(Qe,0),L=new Date(X.setDate(A)).setHours(I,j),M=new Date(L);let U=0,q=0;if(E<68&&(q=48),w.right-w.left-O<250&&(U=250),i.current){const Y=(1440-P)*t.width*4+A*4,Z=bt({rgbArray:new Uint8Array([t.data[Y],t.data[Y+1],t.data[Y+2]])}),ye=Z===0?0:(1.353*(.7*Z)).toFixed(2).substring(1);i.current.innerText=`${M.toLocaleString([],{month:"short",day:"2-digit",hour:"2-digit",minute:"2-digit"})} (${ye} kW/m²)`,i.current.style.transform=`translate(${O+10-U}px, ${E-38+q}px)`}s&&s._setDateForTimezone(M,o),a.current&&(a.current.style.transform=`translateX(${O-1+2}px)`),l.current&&(l.current.style.transform=`translateY(${E-1+2}px)`)},m=Math.floor(d/60),C=e.jsxs("div",{style:{position:"relative",height:"100%"},children:[e.jsx("span",{ref:i,style:{...Q.tooltip}}),e.jsx("div",{ref:a,style:{...Q.crosshair}}),e.jsx("div",{ref:l,style:{...Q.crosshair,...Q.crosshairHorizontal}}),e.jsx("div",{style:Q.totalTime,children:e.jsxs("div",{style:{display:"flex",textAlign:"center",flex:1,justifyContent:"center",alignItems:"center"},children:[e.jsxs("div",{style:Q.timeContainer,children:[e.jsxs("div",{children:[m," hours"]}),e.jsx("div",{style:Q.legend,children:"Annual sunlight"})]}),e.jsxs("div",{style:Q.timeContainer,title:"Energy on horizontal surface",children:[e.jsxs("div",{children:[g.toFixed(0)," kWh/m",e.jsx("sup",{children:"2"})]}),e.jsxs("div",{style:Q.legend,children:["Annual energy ","?"]})]}),e.jsx(To,{profile:t})]})}),e.jsx("canvas",{ref:r,style:{height:"100%",width:"100%",cursor:"none"},onMouseMove:v,onTouchMove:p})]});return Bt.createPortal(C,document.getElementById("canvas"))},Q={tooltip:{position:"absolute",pointerEvents:"none",fontSize:".9em",backgroundColor:"rgb(53, 161, 195)",color:"white",padding:3,borderRadius:3},crosshair:{pointerEvents:"none",position:"absolute",left:-2,height:"100%",width:2,backgroundColor:"rgb(53,161,195)"},crosshairHorizontal:{top:-2,height:2,width:"100%"},totalTime:{position:"absolute",top:0,left:0,right:0,backgroundColor:"black",color:"white",display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"space-between"},timeContainer:{margin:"0 8px 0 8px",display:"flex",flexDirection:"column-reverse",fontSize:".9em"},legend:{color:"#aaa",fontSize:".8em",marginBottom:-2}},No=n=>{const t=ue(),[o,s]=y.useState({data:new Uint8ClampedArray(365*24*60*4),width:365,height:24*60}),[r,i]=y.useState(""),a=F(),l=async()=>{const u=K(a),c=new Promise(p=>{t.on("idle",p)});await Promise.all([u,c]);const d=qe(a);i(d);const b=new Date(Qe,0,1),g=new Date(Qe+1,0,1),f=t._generateLocationShadeProfile({location:a.getCenter(),startDate:new Date(b.getTime()),endDate:new Date(g.getTime()),sunColor:_o,shadeColor:te,tzId:d});s(f)};return y.useEffect(()=>{l(),a.fire("moveend")},[]),ge("moveend",l),e.jsx(Mo,{profile:o,timeZone:r,containerStyle:n.containerStyle})},Ao=()=>{const[n]=y.useState(new Ut.Marker),t=F();return y.useEffect(()=>(n.setLngLat(t.getCenter()).addTo(t),()=>{n.remove()}),[]),ge("move",o=>{const s=o.target;n.setLngLat(s.getCenter())}),null},Po=n=>{const[t,o]=y.useState(!1),{now:s}=n,r=F(),i=ue();return y.useEffect(()=>{const a=document.createElement("div");a.setAttribute("id","canvas"),a.style="height: 100%; flex: 1; background-color: black; touch-action: none; padding: 0 10px 10px 10px; box-sizing: border-box; overflow: hidden;";const l=document.getElementById("root");return l.append(a),l.style.display="flex",o(!0),r.getContainer().style.height="100%",r.getContainer().style.flex="1",r.resize(),r.setPitch(0),r.setMaxPitch(0),()=>{a.remove(),l.style.display="block",i.setDate(s),r.setMaxPitch(null)}},[r,i]),t?e.jsxs(e.Fragment,{children:[e.jsx(No,{}),e.jsx(Ao,{})]}):null};let pe,G;const Io=n=>{const{onUpdate:t,features:o}=n,s=F(),[r,i]=y.useState(!1),[a,l]=y.useState(!1),[u,c]=y.useState(!1),d=h=>{const w=h.properties&&h.properties.height||"",O=parseFloat(prompt(S("height.in.meters"),w)||"0");G.setFeatureProperty(h.id,"height",O)},b=h=>{h.preventDefault(),h.stopPropagation();const O=G.getSelected().features;if(O.length>0){const E=O[0];d(E),x()}else alert(S("nothing.to.edit"))},g=h=>{h.preventDefault(),h.stopPropagation(),G.getSelectedIds().length===0?alert(S("nothing.to.delete")):(G.delete(G.getSelectedIds()),x())},f=h=>{h.preventDefault(),h.stopPropagation(),G.changeMode(a?pe.modes.SIMPLE_SELECT:pe.modes.DRAW_POLYGON),l(w=>!w)},p=h=>{h.preventDefault(),h.stopPropagation();const w=G.getAll();if(w.features.length===0){alert("Nothing to save yet. Draw a feature first.");return}const O=s.getBounds();if(O!==null){const E=O.getSouthWest(),A=O.getNorthEast(),P=[E.lng,E.lat,A.lng,A.lat];w.bbox=P;const I=new Blob([JSON.stringify(w,null,2)],{type:"text/plain"}),j=URL.createObjectURL(I),X=prompt("Name your file");X!==null&&$t({datauri:j,filename:`${X}.geojson`})}};function v(h){d(h.features[0]),x()}function x(){const h=G.getAll();s.getSource(xt).setData(h),t({...h})}if(y.useEffect(()=>{it(()=>import("./mapbox-gl-draw-87715cc4.js").then(w=>w.m),["assets/mapbox-gl-draw-87715cc4.js","assets/client-4fcabb37.js","assets/client-b9e2e652.css"]).then(w=>{pe=w.constants,w.constants.classes.CONTROL_BASE="maplibregl-ctrl",w.constants.classes.CONTROL_PREFIX="maplibregl-ctrl-",w.constants.classes.CONTROL_GROUP="maplibregl-ctrl-group",G=new w.default({displayControlsDefault:!1}),s.addControl(G,"top-right"),s.on(pe.events.CREATE,v),s.on(pe.events.UPDATE,x),s.on(pe.events.MODE_CHANGE,()=>{l(!1)}),i(!0)});const h=()=>{c(window.innerWidth<=Ft+20)};return h(),window.addEventListener("resize",h),()=>{G&&s.removeControl(G),window.removeEventListener("resize",h)}},[s]),y.useEffect(()=>{if(o.features.length>0&&(o.bbox?s.fitBounds(o.bbox,{animate:!1}):s.fitBounds(jn(o),{padding:{top:200,bottom:200,left:200,right:200},minZoom:15,animate:!1}),G)){G.add(o);const h=G.getAll();s.getSource(xt).setData(h),t({...h})}},[o]),!r)return null;const m=s.getZoom()<De,C=m?"Zoom closer to":"",D="url(shape-polygon.svg) center / 26px no-repeat";return e.jsxs(je,{position:"topright",group:!0,style:{marginTop:u?98:8,display:s.getZoom()<De?"none":"block"},children:[e.jsx("button",{disabled:m,onClick:f,style:{backgroundColor:a?me.accent:"transparent"},children:e.jsx("span",{className:`${H}-ctrl-icon`,"aria-hidden":"true",title:`${C} ${S("draw.feature")}`,style:{mask:D,WebkitMask:D,backgroundColor:a?"white":"black"}})}),e.jsx("button",{disabled:m,onClick:b,children:e.jsx("span",{className:`${H}-ctrl-icon`,"aria-hidden":"true",title:`${C} ${S("edit.height")}`,style:{backgroundSize:20,backgroundImage:"url(//fonts.gstatic.com/s/i/short-term/release/materialsymbolsoutlined/height/default/48px.svg)"}})}),e.jsx("button",{disabled:m,onClick:g,children:e.jsx("span",{className:`${H}-ctrl-icon`,"aria-hidden":"true",title:`${C} ${S("delete.feature")}`,style:{backgroundSize:20,backgroundImage:"url(//fonts.gstatic.com/s/i/short-term/release/materialsymbolsoutlined/delete/default/48px.svg)"}})}),e.jsx("button",{disabled:m,onClick:p,children:e.jsx("span",{className:`${H}-ctrl-icon`,"aria-hidden":"true",title:`${C} ${S("save.drawing")}`,style:{backgroundSize:20,backgroundImage:"url(//fonts.gstatic.com/s/i/short-term/release/materialsymbolsoutlined/save/default/48px.svg)"}})})]})},Ro=async n=>{if(n.getZoom()<De)return[];await K(n);const t=n.querySourceFeatures(Gt,{sourceLayer:Be}).concat(n.querySourceFeatures(nn,{sourceLayer:on}));return t.forEach(o=>{o.properties.height=o.properties.height||Wt}),t.sort((o,s)=>o.properties.height-s.properties.height),t},Nt=n=>{const t=F(),o=ue(),[s,r]=y.useState({type:"FeatureCollection",features:[]}),i=a=>{r(a)};return y.useEffect(()=>{o.options.getFeatures=async()=>t.getZoom()<De?[]:[...await Ro(t),...s.features.map(l=>{const u={...l};return u.properties={...u.properties},u.properties.height===void 0&&(u.properties.height||Wt),u.properties.highlight=!0,u})],t.fire("moveend")},[s,o,t]),e.jsx(Io,{features:n.drawnFeatures,onUpdate:i})};let se;async function Lo(n=!1){if(se!==void 0&&!n)return se;if(window.navigator.permissions===void 0)return se=!!window.navigator.geolocation,se;try{se=(await window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{se=!!window.navigator.geolocation}return se}const Fo=n=>{const{updateMapSearch:t}=n,o=F(),s=y.useRef(null);return y.useEffect(()=>{const r=new at.GeolocateControl({fitBoundsOptions:{animate:!1,maxZoom:16},positionOptions:{enableHighAccuracy:!0},showUserHeading:!1,showAccuracyCircle:!1,showUserLocation:!1});return r._map=o,r._container=s.current,Lo().then(i=>r._setupUI(i)),r.on("geolocate",i=>{const{latitude:a,longitude:l}=i.coords,u=`${a.toFixed(5)}, ${l.toFixed(5)}`;t({query:u,marker:{lat:a,lng:l}})}),()=>{r._container={remove:()=>{}},r.onRemove()}},[o]),e.jsx("div",{ref:s})};const Jt="/assets/spinner-8c3b8f57.svg",Bo=()=>{const n=y.useRef(null);return y.useEffect(()=>(n.current&&ze.add(n.current),()=>{ze.remove()}),[]),e.jsx("img",{ref:n,style:{display:"none",width:24,height:24},src:Jt,alt:"Loading indicator"})},zo=n=>{const{mapSearch:t,updateMapSearch:o}=n,[s,r]=y.useState(""),[i,a]=y.useState(!1),l=F();y.useEffect(()=>{let b;return t!==null&&(b=new at.Marker().setLngLat(t.marker).addTo(l),r(t.query)),()=>{b&&b.remove&&(b.remove(),r(""))}},[t]);const u=()=>{r(""),o(null)},c=b=>{r(b.target.value)},d=async b=>{a(!0),b.preventDefault();const[g,f,...p]=s.split(","),v=parseFloat(g),x=parseFloat(f);if(p.length===0&&!isNaN(v)&&!isNaN(x))try{l.flyTo({center:{lat:v,lng:x},zoom:14,animate:!1}),o({query:s,marker:{lat:v,lng:x}}),a(!1);return}catch{}try{const m=navigator.language.substring(0,2),D=await(await fetch(`https://api.mapbox.com/search/geocode/v6/forward?q=${encodeURIComponent(s)}&limit=1&language=${m}&proximity=ip&autocomplete=false&access_token=pk.eyJ1IjoidHBwaW90cm93c2tpIiwiYSI6ImNsMDhnMXNjbTAzMDIzcG80ZzFjMXdlcmMifQ.eITa3IoFjXvNDUOVJg5dFw`)).json();if(D.features.length===0)alert("We can't find that location, please try again.");else{const h=D.features[0].properties,{latitude:w,longitude:O}=h.coordinates,E={lat:w,lng:O},A={animate:!1,center:E,pitch:l.getPitch(),bearing:l.getBearing()};let P=h.bbox;h.bbox||(P=[E,E],A.zoom=16),l.fitBounds(P,A),o({query:s,marker:E})}}catch{alert("We can't find that location, please try again.")}a(!1)};return e.jsx(_e.Fragment,{children:e.jsx("div",{id:"omniboxContainer",children:e.jsxs("div",{style:he.searchBox,children:[e.jsx("form",{onSubmit:d,children:e.jsx("input",{style:he.input,placeholder:`${S("search")}...`,onChange:c,value:s,disabled:i})}),e.jsx("div",{style:{position:"absolute",top:12,right:45,zIndex:2e3},children:e.jsx(Bo,{})}),e.jsx("div",{style:he.searchButtonContainer,children:e.jsx("div",{"aria-label":"Search",style:he.searchAction,children:s.length===0?e.jsx(Fo,{updateMapSearch:o}):e.jsx("button",{style:he.clearButton,children:e.jsx("img",{style:he.image,src:"//www.gstatic.com/images/icons/material/system_gm/2x/close_black_24dp.png",alt:"Clear search",onClick:u})})})})]})})})},he={image:{height:24,width:24,cursor:"pointer"},searchBox:{boxShadow:"0 2px 4px rgba(0,0,0,0.2),0 -1px 0px rgba(0,0,0,0.02)",position:"relative",backgroundColor:"white",boxSizing:"border-box",width:"100%",height:48,padding:"12px 50px 11px 48px"},searchButtonContainer:{position:"absolute",right:0,top:0},searchAction:{padding:"10px 15px",opacity:.32},clearButton:{border:"none",padding:0,paddingTop:2,background:"none"},input:{fontSize:15,margin:0,padding:0,outline:"none",border:"none",width:"100%",height:24,lineHeight:"24px",verticalAlign:"top",backgroundColor:"transparent"}},$o=n=>{const{setDsmFile:t,setGpxFile:o}=n,[s,r]=y.useState(""),[i,a]=y.useState(!1),l=()=>{r("")};return y.useEffect(()=>{(async()=>{try{const c=window.shadeMap_gpxFile;if(c&&(c.indexOf(".gpx")||c.indexOf(".kml"))){a(!0);const g=await(await fetch(c)).text();o({contents:g,name:"gpxFromUrl"}),console.log("GPX loader",window.shadeMap_gpxFile)}const d=window.shadeMap_dsmFile;if(d){a(!0);const b=await fetch(d);if(b.status!==200){r(await b.text());return}const g=b.headers.get("content-disposition");let f="Sample";g!==null&&g.split("filename=").length===2&&(f=g.split("filename=")[1].replaceAll('"',""));const p=await b.arrayBuffer();t({contents:p,name:f}),console.log("DSM loader",window.shadeMap_dsmFile)}}catch{a(!1)}finally{a(!1)}})()},[]),s?e.jsxs(V,{onClick:l,style:{maxWidth:400},children:[e.jsx("p",{children:s}),e.jsx(z,{onClick:l,children:S("ok")})]}):i?e.jsx(V,{onClick:()=>{},style:{maxWidth:400},children:e.jsxs("div",{style:{display:"flex",flexDirection:"row",gap:10},children:[e.jsx("img",{src:Jt}),e.jsx("p",{style:{flex:1},children:S("loading.premium.data")})]})}):null},At={id:"square_km",type:"custom",aPos:0,program:null,buffer:null,gl:null,onAdd:function(n,t){const o=`
    uniform mat4 u_matrix;
    attribute vec2 a_pos;
    void main() {
    gl_Position = u_matrix * vec4(a_pos, 0.0, 1.0);
    }`,s=`
    void main() {
    gl_FragColor = vec4(${.9411764705882353}, ${.2823529411764706}, 0.0, 0.6);
    }`,r=t.createShader(t.VERTEX_SHADER);t.shaderSource(r,o),t.compileShader(r);const i=t.createShader(t.FRAGMENT_SHADER);t.shaderSource(i,s),t.compileShader(i),this.program=t.createProgram(),t.attachShader(this.program,r),t.attachShader(this.program,i),t.linkProgram(this.program),this.aPos=t.getAttribLocation(this.program,"a_pos"),this.buffer=t.createBuffer(),this.gl=t,this.updateLocation(n)},updateLocation(n){if(!this.gl)return;const t=Ut.MercatorCoordinate.fromLngLat(n.getCenter()),o=t.meterInMercatorCoordinateUnits(),s={x:t.x-o*500,y:t.y+o*500},r={x:t.x-o*500,y:t.y-o*500},i={x:t.x+o*500,y:t.y-o*500},a={x:t.x+o*500,y:t.y+o*500};this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.buffer),this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array([r.x,r.y,i.x,i.y,s.x,s.y,a.x,a.y]),this.gl.STATIC_DRAW)},render:function(n,t){this.program&&(n.useProgram(this.program),n.uniformMatrix4fv(n.getUniformLocation(this.program,"u_matrix"),!1,t),n.bindBuffer(n.ARRAY_BUFFER,this.buffer),n.enableVertexAttribArray(this.aPos),n.vertexAttribPointer(this.aPos,2,n.FLOAT,!1,0,0),n.enable(n.BLEND),n.blendFunc(n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA),n.drawArrays(n.TRIANGLE_STRIP,0,4))}};function Uo(n,t,o){const s=Math.min(t,o),r=6378137,i=512,a=2*Math.PI*r/i;let l=0,u;for(u=10;u<20&&(l=a/Math.pow(2,u)*Math.cos(n*(Math.PI/180)),!(l*s<4e3));u++);return u}const Wo=n=>{const{onConfirm:t,onCancel:o}=n,s=F();return ge("move",()=>{At.updateLocation(s)}),y.useEffect(()=>((async()=>{await K(s),s.addLayer(At);const{lat:i}=s.getCenter(),a=Uo(i,window.innerWidth,window.innerHeight);s.setZoom(a),s.setBearing(0),s.setPitch(0),s.setMaxPitch(0)})(),()=>{Fe(s,"square_km"),s.setMaxPitch(null)}),[s]),e.jsxs("div",{style:{position:"fixed",display:"flex",bottom:100,height:100,left:"50%",width:200,marginLeft:-100,flexDirection:"column",alignItems:"center",justifyContent:"center",fontSize:"1.2em",backgroundColor:"white",borderRadius:4,gap:5,zIndex:2,padding:10,boxShadow:"0 2px 15px rgba(0,0,0,0.5)"},children:[e.jsx("div",{style:{fontWeight:"bold",textAlign:"center"},children:S("purchase.area.highlighted")}),e.jsxs("div",{style:{display:"flex",gap:10},children:[e.jsxs(de,{style:{display:"flex",alignItems:"center"},onClick:t,children:[e.jsx(ae,{iconName:"done",color:"white"}),e.jsx("div",{children:S("select")})]}),e.jsxs(z,{style:{display:"flex",alignItems:"center"},onClick:o,children:[e.jsx(ae,{iconName:"close",color:"black"}),e.jsx("div",{children:S("cancel")})]})]})]})},Go=n=>{const{onConfirm:t,onCancel:o}=n,s=F(),[r,i]=y.useState({buyButton:!1,message:"Checking data availability...please wait",date:null,url:""});y.useEffect(()=>{const{lat:c,lng:d}=s.getCenter();(async()=>{try{const g=await fetch(`https://shademap.app/dsm/?lat=${c}&lng=${d}`);if(!g.ok)i({buyButton:!1,message:S("no.data.available"),date:null,url:""});else{const f=await g.json();i({buyButton:!0,message:`${S("tree.data.gathered.on.date")}:`,date:new Date([f.imageryDate.year,f.imageryDate.month.toString().padStart(2,"0"),f.imageryDate.day.toString().padStart(2,"0")].join("-")),url:f.imageryPreview})}}catch{i({buyButton:!1,message:S("not.available"),date:null,url:""})}})()},[s]);const a=async()=>{const{lat:c,lng:d}=s.getCenter();window.open(`https://buy.stripe.com/aEU16577X3WH2di007?client_reference_id=${c.toString().replace(".","_")}x${d.toString().replace(".","_")}`,"_blank"),t();try{await fetch("https://shademap.app/dsm/buyconfirm")}catch{}};let l=null;r.date!==null&&(l=e.jsxs("span",{style:{paddingLeft:3},children:["(",r.date.toLocaleDateString([],{month:"long",year:"numeric"}),")"]}));let u=null;return r.url!==""&&(u=e.jsx("div",{children:e.jsxs(lt,{style:{display:"inline-flex",justifyContent:"center",alignItems:"center",padding:"8px 10px"},href:r.url,target:"_blank",children:[e.jsx(ae,{iconName:"open_in_new",color:"black",style:{paddingRight:5}}),S("preview.data"),l]})})),e.jsxs(V,{onClick:o,children:[!r.buyButton&&e.jsx("p",{children:r.message}),u,r.buyButton&&e.jsxs("div",{children:[e.jsx("p",{children:S("a.shademap.link.displaying")}),e.jsxs("p",{children:[S("when.you.click.purchase"),e.jsx("strong",{children:" stripe.com"})]})]}),e.jsxs("div",{style:{display:"flex",gap:5},children:[r.buyButton&&e.jsx(de,{onClick:a,children:S("purchase")}),e.jsx(z,{onClick:o,children:S("cancel")})]})]})},Pt=n=>{const{imageUrl:t,title:o,cost:s,source:r,error:i,children:a}=n;return e.jsxs("div",{style:{flexDirection:"column",display:"flex",alignItems:"center",...ee.container,backgroundImage:`url(${t})`},children:[e.jsx("div",{style:ee.title,children:o}),e.jsx("div",{style:ee.bottom,children:e.jsxs("table",{style:ee.table,cellSpacing:5,cellPadding:3,children:[e.jsxs("tr",{style:ee.tr,children:[e.jsx("td",{style:ee.tdTitle,children:S("cost")}),e.jsx("td",{children:s})]}),e.jsxs("tr",{style:ee.tr,children:[e.jsx("td",{style:ee.tdTitle,children:S("data.source")}),e.jsx("td",{children:r})]}),e.jsxs("tr",{children:[e.jsx("td",{style:ee.tdTitle,children:S("error")}),e.jsx("td",{children:i})]}),e.jsxs("tr",{children:[e.jsx("td",{}),e.jsx("td",{children:a})]})]})})]})},ee={container:{flex:1,position:"relative",backgroundRepeat:"no-repeat",backgroundSize:"cover",backgroundPosition:"center"},title:{backgroundColor:"rgba(255,255,255,0.9)",fontSize:30,height:40,lineHeight:"40px",marginTop:35,padding:"3px 10px",borderRadius:5,fontWeight:"bold"},bottom:{position:"absolute",bottom:10,maxWidth:300,backgroundColor:"rgba(255,255,255,0.9)",display:"flex",flexDirection:"column",alignItems:"center",padding:10,borderRadius:3},table:{borderCollapse:"collapse"},tdTitle:{fontWeight:"bold",verticalAlign:"top"},tr:{borderBottom:"1px solid grey"},row:{display:"flex",flexDirection:"row"}},Ho=n=>{const{toggleModal:t,onRequestSample:o}=n,[s,r]=y.useState(0),i=F(),a=async()=>{try{await fetch("https://shademap.app/dsm/selectarea")}catch{}r(1)},l=()=>{i.setZoom(15),t()},u=()=>{r(4)};return s===4?e.jsxs(V,{onClick:l,children:[e.jsx("p",{children:S("complete.payment.instructions")}),e.jsxs("p",{children:[e.jsx("a",{href:"https://us6.list-manage.com/contact-form?u=e5e17c9e245874654e775b644&form_id=271345c0ff1a17865f8194ec099c597f",target:"_blank",children:S("contact.us")})," ",S("if.you.need.help"),"."]}),e.jsx(z,{onClick:l,children:S("ok")})]}):s===2?e.jsx(Go,{onConfirm:u,onCancel:l}):s===1?e.jsx(Wo,{onConfirm:async()=>{try{await fetch("https://shademap.app/dsm/confirmarea")}catch{}r(2)},onCancel:l}):e.jsx(V,{onClick:l,style:{display:"flex",flexDirection:"column",maxWidth:1200,maxHeight:784,height:"90%"},children:dt?e.jsxs("div",{style:{flex:1,flexDirection:"column",display:"flex"},children:[e.jsx("div",{style:{backgroundImage:"url(trees.gif)",flex:1,backgroundRepeat:"no-repeat",backgroundSize:"cover",marginTop:25}}),e.jsx("p",{style:{marginBottom:0},children:S("add.tree.shadows.to")}),e.jsxs("p",{children:[S("free.data.inadequate")," "]}),e.jsxs("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",textAlign:"center",gap:5},children:[e.jsxs(de,{onClick:a,title:S("try.a.sample"),style:It.action,children:[e.jsx(ae,{iconName:"shopping_cart",color:"white"}),S("try.a.sample")]}),e.jsxs(z,{title:S("try.a.sample"),onClick:o,style:{...It.action,display:"none"},children:[e.jsx("img",{src:"//fonts.gstatic.com/s/i/short-term/release/materialsymbolsoutlined/download/default/48px.svg",width:"24",height:"24"}),S("try.a.sample")]})]})]}):e.jsxs("div",{style:{display:"flex",flex:1,marginTop:-2,gap:10,position:"relative"},children:[e.jsx(Pt,{imageUrl:"free-shade.jpg",title:"Basic",cost:S("free"),source:"Volunteer database and estimates",error:"1-3 meters",children:e.jsx(z,{onClick:t,children:S("okay.for.now")})}),e.jsx(Pt,{imageUrl:"pro-shade.jpg",title:"💎 Premium 💎",cost:"$2.49 / km²",source:"LiDAR/Photogrammetry",error:"0.25 meters",children:e.jsx(de,{onClick:a,children:S("show.me")})}),e.jsx(lt,{title:"Close","aria-label":"Close",onClick:t,href:"#",style:{position:"absolute",top:5,right:10,display:"flex",justifyContent:"center",alignItems:"center",width:40,height:30,borderRadius:20,backgroundColor:"white"},children:e.jsx(ae,{iconName:"close",color:"black"})}),e.jsx("div",{style:{position:"absolute",left:"50%",marginLeft:-30,height:60,width:60,borderRadius:30,backgroundColor:"white",textAlign:"center",lineHeight:"60px",fontWeight:"bold",top:30,fontSize:28},children:"VS"})]})})},It={action:{display:"flex",alignItems:"center",justifyContent:"center",flexDirection:"column",flex:1}},Xo=n=>{const[t,o]=y.useState(!1),[s,r]=y.useState(!1),{setDsmFile:i,onTimeChange:a}=n,l=F(),u=async()=>{if(await K(l),l.getZoom()>14&&l.queryRenderedFeatures(l.project(l.getCenter()),{layers:["solar-api-coverage-fill"]}).length>0&&l.querySourceFeatures(Gt,{sourceLayer:Be}).filter(f=>f.properties&&f.properties.underground!=="true").length>0){o(!0);return}o(!1)};ge("moveend",async()=>{u()}),y.useEffect(()=>((async()=>{await K(l),l.addLayer({id:"solar-api-coverage-fill",source:rn,"source-layer":"ShadeMapDSM",type:"fill",paint:{"fill-color":"orange","fill-opacity":0}}),u()})(),()=>{Fe(l,"solar-api-coverage-fill")}),[l]);const c=async()=>{fetch(`https://shademap.app/dsm/open/${!s}`).then(()=>{}),r(b=>!b)},d=async()=>{ze.show("dsmSample"),c();const b=await fetch("https://shademap.app/dsm/sample"),g=b.headers.get("content-disposition");let f="Sample";g!==null&&g.split("filename=").length===2&&(f=g.split("filename=")[1].replaceAll('"',""));const p=await b.arrayBuffer();i({name:f,contents:p});const v=new Date(new Date().setUTCHours(17,0,0,0));a(v),ze.hide("dsmSample")};return!t&&!s?null:s?e.jsx(Ho,{toggleModal:c,onRequestSample:d}):e.jsx(Ue,{style:{zIndex:3,top:"auto",bottom:8,borderRadius:4,padding:12},mobileStyle:{width:"100%",top:48,bottom:"auto",borderRadius:0},children:e.jsxs("div",{style:{display:"flex",justifyContent:"center",gap:10,alignItems:"center",margin:-5},children:[e.jsx("div",{style:{fontSize:"0.8em"},children:S("higher.precision.available")}),e.jsx("div",{style:{display:"flex"},children:e.jsxs(de,{style:Zo.cta,onClick:c,children:[S("upgrade")," ⬆️"]})})]})})},Zo={cta:{marginTop:0,display:"flex",justifyContent:"space-around",alignItems:"center",padding:"2px 10px"}};let Rt=0,Lt=0;const Yo=n=>{const{center:t,date:o,mode:s,search:r}=n,i=F(),[a,l]=y.useState(o),[u,c]=y.useState(Intl.DateTimeFormat().resolvedOptions().timeZone),[d,b]=y.useState(s),[g,f]=y.useState(32),p=y.useMemo(()=>({enabled:d.mode===R.SUNEXPOSURE,startDate:d.startDate||a,endDate:d.endDate||a,iterations:g}),[d,g]),[v,x]=y.useState(r),[m,C]=Ce(sn,{sunrise:!1,sunset:!1,now:!1}),[D,h]=Ce(ln,!0),[w,O]=y.useState(t),[E,A]=Ce(an,{value:s.mode===R.SUNEXPOSURE||s.mode===R.ANNUAL_EXPOSURE,forever:!1}),[P,I]=Ce(dn,cn),[j,X]=y.useState(null),[$,L]=y.useState(null),[M,U]=y.useState(null);y.useEffect(()=>{(async()=>{await K(i),c(qe(i))})()},[i]),y.useEffect(()=>{$&&vt($.name)&&(l(new Date("2024-03-21 12:00:00")),b({mode:R.NORMAL}))},[$]),ge("moveend",async k=>{const T=k.target;ke({center:T.getCenter(),zoom:T.getZoom(),date:a,bearing:T.getBearing(),pitch:T.getPitch(),mode:d,search:v}),O(T.getCenter()),d.mode===R.ANNUAL_EXPOSURE&&x(null),await K(T),c(qe(T))});const q=k=>{I(k)},Y=k=>{window.cancelAnimationFrame(Rt),Rt=window.requestAnimationFrame(()=>{l(k)}),window.clearTimeout(Lt),Lt=window.setTimeout(()=>{be(k)},500)},Z=k=>{if(A({value:!0,forever:!1}),k.mode===R.SUNEXPOSURE){if(!k.startDate||!k.endDate){const T=i.getCenter(),{sunrise:N,sunset:W}=Oe(a,T.lat,T.lng,u);k.startDate=N,k.endDate=W}}else{const T=(k.endDate||a).getTime()-(k.startDate||a).getTime();l(new Date((k.startDate||a).getTime()+T/2))}ke({center:i.getCenter(),zoom:i.getZoom(),date:a,bearing:i.getBearing(),pitch:i.getPitch(),mode:k,search:v}),b(k)},ye=k=>{ke({center:i.getCenter(),zoom:i.getZoom(),date:a,bearing:i.getBearing(),pitch:i.getPitch(),mode:d,search:k}),x(k)},be=k=>{ke({center:i.getCenter(),zoom:i.getZoom(),date:k,bearing:i.getBearing(),pitch:i.getPitch(),mode:d,search:v})},xe=k=>{const{startDate:T,endDate:N}=k;Z({...d,startDate:T,endDate:N})},J=k=>({rgb:`#${k.r.toString(16).padStart(2,"0")}${k.g.toString(16).padStart(2,"0")}${k.b.toString(16).padStart(2,"0")}`,opacity:k.a}),Te=k=>{const{x:T,y:N,z:W}=k,we=["a","b","c","d"][(T+N)%4];return oe.SHADEMAP==="aws"?`https://shademap.app/tile/terrain/v1/${W}/${T}/${N}.png?api_key=eyJhbGciOiJIUzI1NiJ9.eyJlbWFpbCI6InRwcGlvdHJvd3NraUBzaGFkZW1hcC5hcHAiLCJjcmVhdGVkIjoxNjYyNDkzMDY2Nzk0LCJpYXQiOjE2NjI0OTMwNjZ9.ovCrLTYsdKFTF6TW3DuODxCaAtGQ3qhcmqj3DWcol5g`:oe.MAPBOXWEBP==="aws"?`https://${we}.tiles.mapbox.com/raster/v1/mapbox.mapbox-terrain-dem-v1/${W}/${T}/${N}.webp?sku=101wuwGrczDtH&access_token=pk.eyJ1IjoidHBwaW90cm93c2tpIiwiYSI6ImNsMDhnMXNjbTAzMDIzcG80ZzFjMXdlcmMifQ.eITa3IoFjXvNDUOVJg5dFw`:oe.AWS==="aws"?`https://s3.amazonaws.com/elevation-tiles-prod/terrarium/${W}/${T}/${N}.png`:`https://${we}.tiles.mapbox.com/v4/mapbox.terrain-rgb/${W}/${T}/${N}.pngraw?sku=101wuwGrczDtH&access_token=pk.eyJ1IjoidHBwaW90cm93c2tpIiwiYSI6ImNsMDhnMXNjbTAzMDIzcG80ZzFjMXdlcmMifQ.eITa3IoFjXvNDUOVJg5dFw`},ve=k=>{const{r:T,g:N,b:W}=k;return oe.SHADEMAP==="aws"||oe.AWS==="aws"?T*256+N+W/256-32768:-1e4+(T*256*256+N*256+W)*.1},Me=oe.MAPBOXWEBP==="aws"?514:256,Ne=oe.SHADEMAP==="aws"?15:oe.MAPBOXWEBP==="aws"?14:15,Ae={getSourceUrl:Te,getElevation:ve,tileSize:Me,maxZoom:Ne,_overzoom:Ne+5},Pe="eyJhbGciOiJIUzI1NiJ9.eyJlbWFpbCI6InRwcGlvdHJvd3NraUBzaGFkZW1hcC5hcHAiLCJjcmVhdGVkIjoxNjYyNDkzMDY2Nzk0LCJpYXQiOjE2NjI0OTMwNjZ9.ovCrLTYsdKFTF6TW3DuODxCaAtGQ3qhcmqj3DWcol5g",{rgb:_,opacity:B}=J(P);if($&&vt($.name)){const k=async()=>{window.open(`https://buy.stripe.com/aEU16577X3WH2di007?client_reference_id=${$.name.toLowerCase().replaceAll("preview","").replaceAll("sample","")}`,"_blank");try{await fetch("https://shademap.app/dsm/buyconfirm")}catch{}};return e.jsxs(e.Fragment,{children:[e.jsx(jt,{file:$}),e.jsx(wt,{date:a,color:_,opacity:B,sunExposure:p,terrainSource:Ae,apiKey:Pe,belowCanopy:D}),e.jsx(Nt,{drawnFeatures:M&&M.contents||{type:"FeatureCollection",features:[]}}),e.jsx(St,{onChange:Y,now:a,timeZone:u,latLng:w,preview:!0}),e.jsx(je,{position:"bottomleft",children:e.jsx(kt,{sunDirectionOptions:m,setSunDirectionOptions:C,belowCanopy:D,setBelowCanopy:h,color:P,onColorChange:q,iterations:g,setIterations:f})}),e.jsxs(Ue,{style:{borderRadius:0,width:"100%"},children:[S("data.preview"),e.jsx(de,{style:{marginLeft:15},onClick:k,children:S("purchase")})]})]})}return e.jsxs(_e.Fragment,{children:[e.jsx(Cn,{}),e.jsx(je,{position:"topleft",children:e.jsx(zo,{mapSearch:v,updateMapSearch:ye})}),e.jsxs(je,{position:"bottomright",children:[e.jsx(Co,{now:a,timeZone:u,mapMode:d}),e.jsx(Oo,{mapMode:d,setMapMode:Z})]}),e.jsxs(je,{position:"bottomleft",children:[e.jsx(kn,{setGpxFile:X,setDsmFile:L,setGeoJsonFile:U}),e.jsx(Eo,{now:a,timeZone:u,mapMode:d}),e.jsx(vo,{}),e.jsx(kt,{sunDirectionOptions:m,setSunDirectionOptions:C,belowCanopy:D,setBelowCanopy:h,color:P,onColorChange:q,iterations:g,setIterations:f})]}),e.jsx(wt,{date:a,color:_,opacity:B,sunExposure:p,terrainSource:Ae,apiKey:Pe,belowCanopy:D}),e.jsx(Nt,{drawnFeatures:M&&M.contents||{type:"FeatureCollection",features:[]}}),d.mode===R.NORMAL&&e.jsx(wo,{now:a,center:w,options:m,timeZone:u}),E.value===!1?e.jsx(Wn,{updateOnboarded:A}):$?e.jsx(Do,{file:$,setDsmFile:L}):e.jsx(Xo,{setDsmFile:L,onTimeChange:Y}),d.mode===R.SUNEXPOSURE&&d.startDate&&d.endDate?e.jsx(jo,{startDate:d.startDate,endDate:d.endDate,timeZone:u,changeDates:xe}):d.mode===R.NORMAL?e.jsx(St,{onChange:Y,now:a,timeZone:u,latLng:w}):e.jsx(Po,{now:a}),j&&e.jsx(En,{file:j}),$&&e.jsx(jt,{file:$}),e.jsx($o,{setDsmFile:L,setGpxFile:X})]})};var et={exports:{}},tt={exports:{}},nt={exports:{}};(function(n,t){Object.defineProperty(t,"__esModule",{value:!0});var o={overlay:function(r){return{position:"fixed",zIndex:1e3,width:"100%",height:"100%",background:"rgba(0, 0, 0, 0.3)",opacity:r?1:0,MozTransform:r?"":"translate3d(100%, 0, 0)",MsTransform:r?"":"translate3d(100%, 0, 0)",OTransform:r?"":"translate3d(100%, 0, 0)",WebkitTransform:r?"":"translate3d(100%, 0, 0)",transform:r?"":"translate3d(100%, 0, 0)",transition:r?"opacity 0.3s":"opacity 0.3s, transform 0s 0.3s"}},menuWrap:function(r,i,a){return{position:"fixed",right:a?0:"inherit",zIndex:1100,width:i,height:"100%",MozTransform:r?"":a?"translate3d(100%, 0, 0)":"translate3d(-100%, 0, 0)",MsTransform:r?"":a?"translate3d(100%, 0, 0)":"translate3d(-100%, 0, 0)",OTransform:r?"":a?"translate3d(100%, 0, 0)":"translate3d(-100%, 0, 0)",WebkitTransform:r?"":a?"translate3d(100%, 0, 0)":"translate3d(-100%, 0, 0)",transform:r?"":a?"translate3d(100%, 0, 0)":"translate3d(-100%, 0, 0)",transition:"all 0.5s"}},menu:function(){return{height:"100%",boxSizing:"border-box",overflow:"auto"}},itemList:function(){return{height:"100%"}},item:function(){return{display:"block"}}};t.default=o,n.exports=t.default})(nt,nt.exports);var qo=nt.exports,ne={};Object.defineProperty(ne,"__esModule",{value:!0});ne.focusOnFirstMenuItem=Kt;ne.focusOnLastMenuItem=Vt;ne.focusOnCrossButton=Qt;ne.focusOnMenuButton=Jo;ne.focusOnMenuItem=ut;ne.focusOnNextMenuItem=Ko;ne.focusOnPreviousMenuItem=Vo;function Kt(){var n=Array.from(document.getElementsByClassName("bm-item")).shift();n&&n.focus()}function Vt(){var n=Array.from(document.getElementsByClassName("bm-item")).pop();n&&n.focus()}function Qt(){var n=document.getElementById("react-burger-cross-btn");n&&n.focus()}function Jo(){var n=document.getElementById("react-burger-menu-btn");n&&n.focus()}function ut(n){if(document.activeElement.className.includes("bm-item")){var t=document.activeElement[n];t?t.focus():Qt()}else n==="previousElementSibling"?Vt():Kt()}function Ko(){ut("nextElementSibling")}function Vo(){ut("previousElementSibling")}var ot={exports:{}};(function(n,t){Object.defineProperty(t,"__esModule",{value:!0});var o=Object.assign||function(f){for(var p=1;p<arguments.length;p++){var v=arguments[p];for(var x in v)Object.prototype.hasOwnProperty.call(v,x)&&(f[x]=v[x])}return f},s=function(){function f(p,v){for(var x=0;x<v.length;x++){var m=v[x];m.enumerable=m.enumerable||!1,m.configurable=!0,"value"in m&&(m.writable=!0),Object.defineProperty(p,m.key,m)}}return function(p,v,x){return v&&f(p.prototype,v),x&&f(p,x),p}}(),r=function(p,v,x){var m=!0;e:for(;m;){var C=p,D=v,h=x;m=!1,C===null&&(C=Function.prototype);var w=Object.getOwnPropertyDescriptor(C,D);if(w===void 0){var O=Object.getPrototypeOf(C);if(O===null)return;p=O,v=D,x=h,m=!0,w=O=void 0;continue e}else{if("value"in w)return w.value;var E=w.get;return E===void 0?void 0:E.call(h)}}};function i(f){return f&&f.__esModule?f:{default:f}}function a(f,p){if(!(f instanceof p))throw new TypeError("Cannot call a class as a function")}function l(f,p){if(typeof p!="function"&&p!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof p);f.prototype=Object.create(p&&p.prototype,{constructor:{value:f,enumerable:!1,writable:!0,configurable:!0}}),p&&(Object.setPrototypeOf?Object.setPrototypeOf(f,p):f.__proto__=p)}var u=y,c=i(u),d=st,b=i(d),g=function(f){l(p,f);function p(v){a(this,p),r(Object.getPrototypeOf(p.prototype),"constructor",this).call(this,v),this.state={hover:!1}}return s(p,[{key:"getLineStyle",value:function(x){return o({position:"absolute",height:"20%",left:0,right:0,top:20*(x*2)+"%",opacity:this.state.hover?.6:1},this.state.hover&&this.props.styles.bmBurgerBarsHover)}},{key:"render",value:function(){var x=this,m=void 0,C={position:"absolute",left:0,top:0,zIndex:1,width:"100%",height:"100%",margin:0,padding:0,border:"none",fontSize:0,background:"transparent",cursor:"pointer"};if(this.props.customIcon){var D={className:("bm-icon "+(this.props.customIcon.props.className||"")).trim(),style:o({width:"100%",height:"100%"},this.props.styles.bmIcon)};m=c.default.cloneElement(this.props.customIcon,D)}else m=c.default.createElement("span",null,[0,1,2].map(function(h){return c.default.createElement("span",{key:h,className:("bm-burger-bars "+x.props.barClassName+" "+(x.state.hover?"bm-burger-bars-hover":"")).trim(),style:o({},x.getLineStyle(h),x.props.styles.bmBurgerBars)})}));return c.default.createElement("div",{className:("bm-burger-button "+this.props.className).trim(),style:o({zIndex:1e3},this.props.styles.bmBurgerButton)},c.default.createElement("button",{type:"button",id:"react-burger-menu-btn",onClick:this.props.onClick,onMouseOver:function(){x.setState({hover:!0}),x.props.onIconHoverChange&&x.props.onIconHoverChange({isMouseIn:!0})},onMouseOut:function(){x.setState({hover:!1}),x.props.onIconHoverChange&&x.props.onIconHoverChange({isMouseIn:!1})},style:C},"Open Menu"),m)}}]),p}(u.Component);t.default=g,g.propTypes={barClassName:b.default.string,customIcon:b.default.element,styles:b.default.object},g.defaultProps={barClassName:"",className:"",styles:{}},n.exports=t.default})(ot,ot.exports);var Qo=ot.exports,rt={exports:{}};(function(n,t){Object.defineProperty(t,"__esModule",{value:!0});var o=Object.assign||function(f){for(var p=1;p<arguments.length;p++){var v=arguments[p];for(var x in v)Object.prototype.hasOwnProperty.call(v,x)&&(f[x]=v[x])}return f},s=function(){function f(p,v){for(var x=0;x<v.length;x++){var m=v[x];m.enumerable=m.enumerable||!1,m.configurable=!0,"value"in m&&(m.writable=!0),Object.defineProperty(p,m.key,m)}}return function(p,v,x){return v&&f(p.prototype,v),x&&f(p,x),p}}(),r=function(p,v,x){var m=!0;e:for(;m;){var C=p,D=v,h=x;m=!1,C===null&&(C=Function.prototype);var w=Object.getOwnPropertyDescriptor(C,D);if(w===void 0){var O=Object.getPrototypeOf(C);if(O===null)return;p=O,v=D,x=h,m=!0,w=O=void 0;continue e}else{if("value"in w)return w.value;var E=w.get;return E===void 0?void 0:E.call(h)}}};function i(f){return f&&f.__esModule?f:{default:f}}function a(f,p){if(!(f instanceof p))throw new TypeError("Cannot call a class as a function")}function l(f,p){if(typeof p!="function"&&p!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof p);f.prototype=Object.create(p&&p.prototype,{constructor:{value:f,enumerable:!1,writable:!0,configurable:!0}}),p&&(Object.setPrototypeOf?Object.setPrototypeOf(f,p):f.__proto__=p)}var u=y,c=i(u),d=st,b=i(d),g=function(f){l(p,f);function p(){a(this,p),r(Object.getPrototypeOf(p.prototype),"constructor",this).apply(this,arguments)}return s(p,[{key:"getCrossStyle",value:function(x){return{position:"absolute",width:3,height:14,transform:x==="before"?"rotate(45deg)":"rotate(-45deg)"}}},{key:"render",value:function(){var x=this,m,C={position:"absolute",width:24,height:24,right:8,top:8},D={position:"absolute",left:0,top:0,zIndex:1,width:"100%",height:"100%",margin:0,padding:0,border:"none",fontSize:0,background:"transparent",cursor:"pointer"};if(this.props.customIcon){var h={className:("bm-cross "+(this.props.customIcon.props.className||"")).trim(),style:o({width:"100%",height:"100%"},this.props.styles.bmCross)};m=c.default.cloneElement(this.props.customIcon,h)}else m=c.default.createElement("span",{style:{position:"absolute",top:"6px",right:"14px"}},["before","after"].map(function(w,O){return c.default.createElement("span",{key:O,className:("bm-cross "+x.props.crossClassName).trim(),style:o({},x.getCrossStyle(w),x.props.styles.bmCross)})}));return c.default.createElement("div",{className:("bm-cross-button "+this.props.className).trim(),style:o({},C,this.props.styles.bmCrossButton)},c.default.createElement("button",o({type:"button",id:"react-burger-cross-btn",onClick:this.props.onClick,style:D},!this.props.isOpen&&{tabIndex:-1}),"Close Menu"),m)}}]),p}(u.Component);t.default=g,g.propTypes={crossClassName:b.default.string,customIcon:b.default.element,isOpen:b.default.bool,styles:b.default.object},g.defaultProps={crossClassName:"",className:"",styles:{},isOpen:!1},n.exports=t.default})(rt,rt.exports);var er=rt.exports;(function(n,t){Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function m(C,D){var h=[],w=!0,O=!1,E=void 0;try{for(var A=C[Symbol.iterator](),P;!(w=(P=A.next()).done)&&(h.push(P.value),!(D&&h.length===D));w=!0);}catch(I){O=!0,E=I}finally{try{!w&&A.return&&A.return()}finally{if(O)throw E}}return h}return function(C,D){if(Array.isArray(C))return C;if(Symbol.iterator in Object(C))return m(C,D);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),s=Object.assign||function(m){for(var C=1;C<arguments.length;C++){var D=arguments[C];for(var h in D)Object.prototype.hasOwnProperty.call(D,h)&&(m[h]=D[h])}return m};function r(m){return m&&m.__esModule?m:{default:m}}var i=y,a=r(i),l=un;r(l);var u=st,c=r(u),d=qo,b=r(d),g=ne,f=Qo,p=r(f),v=er,x=r(v);t.default=function(m){if(!m)throw new Error("No styles supplied");var C="ArrowDown",D="ArrowUp",h="Escape",w=" ",O="Home",E="End";function A(I){var j=a.default.useRef(I);return a.default.useEffect(function(){j.current=I}),j.current}var P=function(j){var X=a.default.useState(!1),$=o(X,2),L=$[0],M=$[1],U=a.default.useRef(),q=a.default.useRef({}),Y=A(j.isOpen);a.default.useEffect(function(){return j.isOpen&&Z({isOpen:!0,noStateChange:!0}),function(){ve(!1),Me()}},[]),a.default.useEffect(function(){var _=typeof j.isOpen<"u"&&j.isOpen!==L&&j.isOpen!==Y;if(_){Z();return}m.svg&&function(){var B=document.getElementById("bm-morph-shape"),k=m.svg.lib(B).select("path");L?m.svg.animate(k):setTimeout(function(){k.attr("d",m.svg.pathInitial)},300)}()}),a.default.useEffect(function(){var _=q.current,B=_.noStateChange,k=_.focusOnLastItem;B||j.onStateChange({isOpen:L}),j.disableAutoFocus||(L?k?(0,g.focusOnLastMenuItem)():(0,g.focusOnFirstMenuItem)():document.activeElement?document.activeElement.blur():document.body.blur()),Me(),U.current=setTimeout(function(){U.current=null,L||ve(!1)},500);var T=L?Ne:Ae,N=j.customOnKeyDown||T;return window.addEventListener("keydown",N),function(){window.removeEventListener("keydown",N)}},[L]);function Z(){var _=arguments.length<=0||arguments[0]===void 0?{}:arguments[0];q.current=_,ve(),setTimeout(function(){M(function(B){return typeof _.isOpen<"u"?_.isOpen:!B})})}function ye(){typeof j.onOpen=="function"?j.onOpen():Z()}function be(){typeof j.onClose=="function"?j.onClose():Z()}function xe(_,B){var k=j.width,T=j.right,N=typeof k!="string"?k+"px":k;return _(L,N,T,B)}function J(_,B,k){var T="bm"+_.replace(_.charAt(0),_.charAt(0).toUpperCase()),N=b.default[_]?xe(b.default[_]):{};return m[_]&&(N=s({},N,xe(m[_],B+1))),j.styles[T]&&(N=s({},N,j.styles[T])),k&&(N=s({},N,k)),j.noTransition&&delete N.transition,N}function Te(_,B,k){var T=document.getElementById(_);if(!T){console.error("Element with ID '"+_+"' not found");return}var N=xe(B);for(var W in N)N.hasOwnProperty(W)&&(T.style[W]=k?N[W]:"");var we=function(en){return en.style["overflow-x"]=k?"hidden":""};j.htmlClassName||we(document.querySelector("html")),j.bodyClassName||we(document.querySelector("body"))}function ve(){var _=arguments.length<=0||arguments[0]===void 0?!0:arguments[0],B=function(N,W){return N.classList[_?"add":"remove"](W)};j.htmlClassName&&B(document.querySelector("html"),j.htmlClassName),j.bodyClassName&&B(document.querySelector("body"),j.bodyClassName),m.pageWrap&&j.pageWrapId&&Te(j.pageWrapId,m.pageWrap,_),m.outerContainer&&j.outerContainerId&&Te(j.outerContainerId,m.outerContainer,_);var k=document.querySelector(".bm-menu-wrap");k&&(_?k.removeAttribute("hidden"):k.setAttribute("hidden",!0))}function Me(){U.current&&clearTimeout(U.current)}function Ne(_){switch(_=_||window.event,_.key){case h:j.disableCloseOnEsc||(be(),(0,g.focusOnMenuButton)());break;case C:(0,g.focusOnNextMenuItem)();break;case D:(0,g.focusOnPreviousMenuItem)();break;case O:(0,g.focusOnFirstMenuItem)();break;case E:(0,g.focusOnLastMenuItem)();break}}function Ae(_){if(_=_||window.event,_.target===document.getElementById("react-burger-menu-btn"))switch(_.key){case C:case w:Z();break;case D:Z({focusOnLastItem:!0});break}}function Pe(){j.disableOverlayClick===!0||typeof j.disableOverlayClick=="function"&&j.disableOverlayClick()||be()}return a.default.createElement("div",null,!j.noOverlay&&a.default.createElement("div",{className:("bm-overlay "+j.overlayClassName).trim(),onClick:Pe,style:J("overlay")}),j.customBurgerIcon!==!1&&a.default.createElement("div",{style:J("burgerIcon")},a.default.createElement(p.default,{onClick:ye,styles:j.styles,customIcon:j.customBurgerIcon,className:j.burgerButtonClassName,barClassName:j.burgerBarClassName,onIconStateChange:j.onIconStateChange})),a.default.createElement("div",{id:j.id,className:("bm-menu-wrap "+j.className).trim(),style:J("menuWrap"),"aria-hidden":!L},m.svg&&a.default.createElement("div",{id:"bm-morph-shape",className:("bm-morph-shape "+j.morphShapeClassName).trim(),style:J("morphShape")},a.default.createElement("svg",{width:"100%",height:"100%",viewBox:"0 0 100 800",preserveAspectRatio:"none"},a.default.createElement("path",{d:m.svg.pathInitial}))),a.default.createElement("div",{className:("bm-menu "+j.menuClassName).trim(),style:J("menu")},a.default.createElement(j.itemListElement,{className:("bm-item-list "+j.itemListClassName).trim(),style:J("itemList")},a.default.Children.map(j.children,function(_,B){if(_){var k=["bm-item",j.itemClassName,_.props.className].filter(function(N){return!!N}).join(" "),T=s({key:B,className:k,style:J("item",B,_.props.style)},!L&&{tabIndex:-1});return a.default.cloneElement(_,T)}}))),j.customCrossIcon!==!1&&a.default.createElement("div",{style:J("closeButton")},a.default.createElement(x.default,{onClick:be,styles:j.styles,customIcon:j.customCrossIcon,className:j.crossButtonClassName,crossClassName:j.crossClassName,isOpen:L}))))};return P.propTypes={bodyClassName:c.default.string,burgerBarClassName:c.default.string,burgerButtonClassName:c.default.string,className:c.default.string,crossButtonClassName:c.default.string,crossClassName:c.default.string,customBurgerIcon:c.default.oneOfType([c.default.element,c.default.oneOf([!1])]),customCrossIcon:c.default.oneOfType([c.default.element,c.default.oneOf([!1])]),customOnKeyDown:c.default.func,disableAutoFocus:c.default.bool,disableCloseOnEsc:c.default.bool,disableOverlayClick:c.default.oneOfType([c.default.bool,c.default.func]),htmlClassName:c.default.string,id:c.default.string,isOpen:c.default.bool,itemClassName:c.default.string,itemListClassName:c.default.string,itemListElement:c.default.oneOf(["div","nav"]),menuClassName:c.default.string,morphShapeClassName:c.default.string,noOverlay:c.default.bool,noTransition:c.default.bool,onClose:c.default.func,onIconHoverChange:c.default.func,onOpen:c.default.func,onStateChange:c.default.func,outerContainerId:m&&m.outerContainer?c.default.string.isRequired:c.default.string,overlayClassName:c.default.string,pageWrapId:m&&m.pageWrap?c.default.string.isRequired:c.default.string,right:c.default.bool,styles:c.default.object,width:c.default.oneOfType([c.default.number,c.default.string])},P.defaultProps={bodyClassName:"",burgerBarClassName:"",burgerButtonClassName:"",className:"",crossButtonClassName:"",crossClassName:"",disableAutoFocus:!1,disableCloseOnEsc:!1,htmlClassName:"",id:"",itemClassName:"",itemListClassName:"",menuClassName:"",morphShapeClassName:"",noOverlay:!1,noTransition:!1,onStateChange:function(){},outerContainerId:"",overlayClassName:"",pageWrapId:"",styles:{},width:300,onIconHoverChange:function(){},itemListElement:"nav"},P},n.exports=t.default})(tt,tt.exports);var tr=tt.exports;(function(n,t){Object.defineProperty(t,"__esModule",{value:!0});function o(a){return a&&a.__esModule?a:{default:a}}var s=tr,r=o(s),i={};t.default=(0,r.default)(i),n.exports=t.default})(et,et.exports);var nr=et.exports;const or=zt(nr),Le={hamburgerContainer:{display:"inline-block",position:"absolute",zIndex:902,left:0,top:0},hamburgerButton:{display:"block",cursor:"pointer",margin:0,padding:12,opacity:.62,border:0,backgroundColor:"transparent"},hamburgerImage:{height:24,width:24},bmBurgerButton:{position:"fixed",width:"0px",height:"0px",left:"0px",top:"0px"},bmBurgerBars:{background:"#373a47"},bmBurgerBarsHover:{background:"#a90000"},bmCrossButton:{display:"none"},bmCross:{display:"none"},bmMenuWrap:{position:"fixed",height:"100%"},bmMenu:{background:"#373a47",padding:"1em 1.5em 0",fontSize:"1.15em"},bmMorphShape:{fill:"#373a47"},bmItemList:{color:"#b8b7ad"},bmItem:{display:"block",fontSize:"1.15em",padding:".8em",fontWeight:"bold",border:"none",backgroundColor:"transparent",cursor:"pointer",margin:0},bmOverlay:{background:"rgba(0, 0, 0, 0.5)",zIndex:1100}};const rr=()=>{const[n,t]=y.useState(!1),o=y.useRef(null),r=F().setTerrain!==void 0,i=()=>{t(!0)},a=()=>{t(!1)};return e.jsxs("div",{ref:o,children:[e.jsx("div",{style:Le.hamburgerContainer,id:"hamburgerContainer",children:e.jsx("button",{"aria-label":"Menu",style:Le.hamburgerButton,onClick:i,children:e.jsx("img",{style:Le.hamburgerImage,src:"//www.gstatic.com/images/icons/material/system_gm/2x/menu_black_24dp.png",alt:"Menu"})})}),e.jsxs(or,{styles:Le,disableAutoFocus:!0,isOpen:n,onClose:a,children:[e.jsxs("a",{href:"./",style:{position:"relative",display:"flex",flexDirection:"column",textDecoration:"none",color:"white"},children:[e.jsx("img",{src:"/logo-white.svg",style:{width:200},alt:"Shade Map",loading:"lazy"}),e.jsx("span",{style:{...Ze.badge,background:r?me.accent:"green"},children:r?"Pro":"Free"}),e.jsx("span",{style:{alignSelf:"flex-end",fontWeight:"normal",marginTop:-8},children:"Global sun simulation"})]}),e.jsx("a",{href:"https://us6.list-manage.com/contact-form?u=e5e17c9e245874654e775b644&form_id=271345c0ff1a17865f8194ec099c597f",target:"_blank",rel:"noreferrer noopener",children:e.jsx("span",{children:S("contact")})}),e.jsx("a",{href:"/help/",target:"_blank",rel:"noreferrer noopener",children:e.jsx("span",{children:S("Help")})}),e.jsx("a",{href:"/about/",target:"_blank",rel:"noreferrer noopener",children:e.jsx("span",{children:S("build")})}),e.jsxs("a",{href:"https://twitter.com/shademap",target:"_blank",rel:"nofollow noopener noreferrer",style:{display:"flex",gap:10},children:[e.jsx("span",{children:"Follow"}),e.jsx("span",{title:"News and updates",style:{display:"inline-block",height:20,width:20,backgroundRepeat:"no-repeat",backgroundPosition:"center center",backgroundSize:20,backgroundImage:"url(./tw.svg)"}})]}),e.jsx("hr",{}),e.jsx("a",{href:"/shadeprofile/",rel:"noreferrer noopener",children:e.jsx("span",{style:Ze.experimental,children:S("trail.shade")})}),e.jsx("a",{href:"/gpxreplay/",target:"_blank",rel:"noreferrer noopener",children:e.jsx("span",{style:Ze.experimental,children:S("gpx.replay")})}),e.jsx("hr",{}),e.jsx("a",{href:"/terms/",target:"_blank",rel:"noreferrer noopener",children:e.jsx("span",{children:"Terms of Service"})}),e.jsx("a",{href:"/privacy/",target:"_blank",rel:"noreferrer noopener",children:e.jsx("span",{children:"Privacy Policy"})})]})]})},Ze={badge:{position:"absolute",top:10,left:0,textTransform:"uppercase",fontSize:".9em",padding:"2px 3px",fontWeight:"bold",borderRadius:3},subtext:{fontWeight:"normal",paddingLeft:10},external:{background:"url(//www.gstatic.com/images/icons/material/system_gm/2x/open_in_new_white_24dp.png) no-repeat right center",backgroundSize:20,paddingRight:24},experimental:{background:"url(//www.gstatic.com/images/icons/material/system_gm/2x/science_white_24dp.png) no-repeat right center",backgroundSize:20,paddingRight:24}},ar=()=>e.jsxs("div",{style:{display:"flex",alignItems:"center",flexDirection:"column"},children:[e.jsx("img",{src:"./logo-black.svg",alt:"Shade Map",style:{width:200,marginTop:10}}),e.jsx("h1",{style:{textAlign:"center"},children:"Online shadow map and sun finder"}),e.jsxs("ul",{children:[e.jsx("li",{children:"Shadowmap and sunmap a house or garden"}),e.jsx("li",{children:"Shadow calculator, sun position, sun path and sun exposure"}),e.jsx("li",{children:"Simulate shadows cast by buildings, trees and terrain in 3D"}),e.jsx("li",{children:"Sunlight and shading for sunrise and sunset photos"}),e.jsx("li",{children:"Prepare a shadow study, shadow analysis or solar analysis"}),e.jsx("li",{children:"No need to install or buy Google Earth Pro. Works online"}),e.jsx("li",{children:"Generate shadow accumulation and shadow accrual maps"})]}),e.jsx("noscript",{children:"You need to enable JavaScript to run this app."})]}),sr=n=>{const{center:t,zoom:o,date:s,bearing:r,pitch:i,minZoom:a,mode:l,search:u}=n;return e.jsx(fn,{minZoom:a,center:t,zoom:o,container:"junk",accessToken:{}.VITE_MAPTILER_KEY,style:pn,bearing:r,pitch:i,maxPitch:45,renderWorldCopies:!0,placeholder:e.jsx(ar,{}),containerStyle:{height:"calc(100% - 80px)",WebkitUserSelect:"none"},zoomControl:!0,children:e.jsx(On,{isMaplibre:hn,children:e.jsxs(mn,{children:[e.jsx(rr,{}),e.jsx(Yo,{date:s,center:t,mode:l,search:u})]})})})};gn({dsn:"https://6810e4b20de7410c8cf061594d0d29ef@o4504891627732992.ingest.sentry.io/4504891629305856",integrations:[new yn],tracesSampleRate:1});String.prototype.replaceAll||(String.prototype.replaceAll=function(n,t){return this.split(n).join(t)});window.onresize=function(){document.body.style.height=`${window.innerHeight}px`};window.onresize(0);const ir=new Promise(n=>{document.prerendering?document.addEventListener("prerenderingchange",n):n(null)});async function lr(){await ir;const n=Sn(),{zoom:t,center:o,date:s,bearing:r,pitch:i,mode:a,search:l}=await zn({center:xn,zoom:vn,date:new Date,bearing:0,pitch:0,minZoom:n,mode:{mode:R.NORMAL},search:null});ke({center:o,zoom:t,date:s,bearing:r,pitch:i,mode:a,search:l});const u=document.getElementById("root");wn(u).render(e.jsx(sr,{center:o,zoom:t,date:s,minZoom:n,bearing:r,pitch:i,mode:a,search:l}))}lr();bn();export{z as B};