"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[82162],{22699:function(e){var t,r="object"==typeof Reflect?Reflect:null,n=r&&"function"==typeof r.apply?r.apply:function(e,t,r){return Function.prototype.apply.call(e,t,r)};t=r&&"function"==typeof r.ownKeys?r.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var i=Number.isNaN||function(e){return e!=e};function o(){o.init.call(this)}e.exports=o,e.exports.once=function(e,t){return new Promise(function(r,n){function i(r){e.removeListener(t,o),n(r)}function o(){"function"==typeof e.removeListener&&e.removeListener("error",i),r([].slice.call(arguments))}d(e,t,o,{once:!0}),"error"!==t&&"function"==typeof e.on&&d(e,"error",i,{once:!0})})},o.EventEmitter=o,o.prototype._events=void 0,o.prototype._eventsCount=0,o.prototype._maxListeners=void 0;var a=10;function s(e){if("function"!=typeof e)throw TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function c(e){return void 0===e._maxListeners?o.defaultMaxListeners:e._maxListeners}function u(e,t,r,n){if(s(r),void 0===(o=e._events)?(o=e._events=Object.create(null),e._eventsCount=0):(void 0!==o.newListener&&(e.emit("newListener",t,r.listener?r.listener:r),o=e._events),a=o[t]),void 0===a)a=o[t]=r,++e._eventsCount;else if("function"==typeof a?a=o[t]=n?[r,a]:[a,r]:n?a.unshift(r):a.push(r),(i=c(e))>0&&a.length>i&&!a.warned){a.warned=!0;var i,o,a,u=Error("Possible EventEmitter memory leak detected. "+a.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");u.name="MaxListenersExceededWarning",u.emitter=e,u.type=t,u.count=a.length,console&&console.warn&&console.warn(u)}return e}function l(){if(!this.fired)return(this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0==arguments.length)?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function m(e,t,r){var n={fired:!1,wrapFn:void 0,target:e,type:t,listener:r},i=l.bind(n);return i.listener=r,n.wrapFn=i,i}function h(e,t,r){var n=e._events;if(void 0===n)return[];var i=n[t];return void 0===i?[]:"function"==typeof i?r?[i.listener||i]:[i]:r?function(e){for(var t=Array(e.length),r=0;r<t.length;++r)t[r]=e[r].listener||e[r];return t}(i):p(i,i.length)}function f(e){var t=this._events;if(void 0!==t){var r=t[e];if("function"==typeof r)return 1;if(void 0!==r)return r.length}return 0}function p(e,t){for(var r=Array(t),n=0;n<t;++n)r[n]=e[n];return r}function d(e,t,r,n){if("function"==typeof e.on)n.once?e.once(t,r):e.on(t,r);else if("function"==typeof e.addEventListener)e.addEventListener(t,function i(o){n.once&&e.removeEventListener(t,i),r(o)});else throw TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e)}Object.defineProperty(o,"defaultMaxListeners",{enumerable:!0,get:function(){return a},set:function(e){if("number"!=typeof e||e<0||i(e))throw RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");a=e}}),o.init=function(){(void 0===this._events||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},o.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||i(e))throw RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},o.prototype.getMaxListeners=function(){return c(this)},o.prototype.emit=function(e){for(var t=[],r=1;r<arguments.length;r++)t.push(arguments[r]);var i="error"===e,o=this._events;if(void 0!==o)i=i&&void 0===o.error;else if(!i)return!1;if(i){if(t.length>0&&(a=t[0]),a instanceof Error)throw a;var a,s=Error("Unhandled error."+(a?" ("+a.message+")":""));throw s.context=a,s}var c=o[e];if(void 0===c)return!1;if("function"==typeof c)n(c,this,t);else for(var u=c.length,l=p(c,u),r=0;r<u;++r)n(l[r],this,t);return!0},o.prototype.addListener=function(e,t){return u(this,e,t,!1)},o.prototype.on=o.prototype.addListener,o.prototype.prependListener=function(e,t){return u(this,e,t,!0)},o.prototype.once=function(e,t){return s(t),this.on(e,m(this,e,t)),this},o.prototype.prependOnceListener=function(e,t){return s(t),this.prependListener(e,m(this,e,t)),this},o.prototype.removeListener=function(e,t){var r,n,i,o,a;if(s(t),void 0===(n=this._events)||void 0===(r=n[e]))return this;if(r===t||r.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete n[e],n.removeListener&&this.emit("removeListener",e,r.listener||t));else if("function"!=typeof r){for(i=-1,o=r.length-1;o>=0;o--)if(r[o]===t||r[o].listener===t){a=r[o].listener,i=o;break}if(i<0)return this;0===i?r.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(r,i),1===r.length&&(n[e]=r[0]),void 0!==n.removeListener&&this.emit("removeListener",e,a||t)}return this},o.prototype.off=o.prototype.removeListener,o.prototype.removeAllListeners=function(e){var t,r,n;if(void 0===(r=this._events))return this;if(void 0===r.removeListener)return 0==arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==r[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete r[e]),this;if(0==arguments.length){var i,o=Object.keys(r);for(n=0;n<o.length;++n)"removeListener"!==(i=o[n])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=r[e]))this.removeListener(e,t);else if(void 0!==t)for(n=t.length-1;n>=0;n--)this.removeListener(e,t[n]);return this},o.prototype.listeners=function(e){return h(this,e,!0)},o.prototype.rawListeners=function(e){return h(this,e,!1)},o.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):f.call(e,t)},o.prototype.listenerCount=f,o.prototype.eventNames=function(){return this._eventsCount>0?t(this._events):[]}},428915:function(e,t,r){r.d(t,{Z:function(){return n}});let n="M22 10v3h-1v-3a5 5 0 0 0-10 0v3h-1v-3a6 6 0 0 1 12 0zm3 20H7a2.006 2.006 0 0 1-2-2V16a2.006 2.006 0 0 1 2-2h1v-4a8 8 0 0 1 16 0v4h1a2.006 2.006 0 0 1 2 2v12a2.006 2.006 0 0 1-2 2zM9 14h1v-1h1v1h10v-1h1v1h1v-4a7 7 0 0 0-14 0zM7 29h18a1.001 1.001 0 0 0 1-1V16a1.001 1.001 0 0 0-1-1H7a1.001 1.001 0 0 0-1 1v12a1.001 1.001 0 0 0 1 1zm9-10h1v-1h-1zm-1 7h1v-1h1v-1h-1v-1h1v-1h-1v-1h1v-1h-1v-1h-1z"},811327:function(e,t,r){r.d(t,{Z:function(){return C}});var n=r(552322),i=r(202784),o=r(342670),a=r(205632),s=r(794975),c=r(293786),u=r(183351),l=r(355125),m=r(902183),h=r(850358),f=r(819556),p=r(863982),d=r(936190),v=r(567523),y=r(65032),g=r(140995),w=r(612423);async function T(e){let{newItemType:t,templateItemId:r,authManager:n,storyMapUserPrivileges:i,config:o}=e,a=new g.eG({type:t,authManager:n,version:"published",getStoryMapUserPrivileges:()=>i,config:o});if(a.itemId=r,a.itemDetails=await g.eG.fetchItemDetails({itemId:a.itemId,authManager:n,portalHost:o.PORTAL_HOST}),!(0,m.qg)(a.itemDetails))throw Error(`${r} is not a template`);let s=await a.duplicateStory(["published","from-template"]);return{success:s.success,id:s.itemId}}let b=function(e){let{title:t,itemType:r,theme:n,webmap:o,webscene:a,template:s,isTemplate:u}=e,m=(0,h.ZR)(),{authManager:g,storyMapUserPrivileges:b}=(0,l.Pc)(),{routeTo:_}=(0,v.Gr)(),C=(0,f.bd)(),L=(0,i.useCallback)(async function(){return g?s&&!(0,w.so)(s)?await T({templateItemId:s,newItemType:r,authManager:g,storyMapUserPrivileges:b,config:m}):await (0,y.gi)({authManager:g,config:m,isTemplate:u,baseThemeId:(0,d.TI)(m.INCLUDED_STORY_THEMES),...function(){let e=t?.substring(0,p.xP),i=new Map([[c.o.Briefing,{itemType:c.o.Briefing,title:e,theme:n,featureDecisions:C}],[c.o.Collection,{itemType:c.o.Collection,title:e,theme:n}],[c.o.Frame,{itemType:c.o.Frame,title:e,theme:n,featureDecisions:C}],[c.o.Story,{itemType:c.o.Story,title:e,webmap:o,webscene:a,template:s,theme:n,featureDecisions:C}],[c.o.Theme,{itemType:c.o.Theme}]]);if(!i.has(r))throw Error(`Unhandled case for StoryItemType: ${r}`);return i.get(r)}()}):void 0},[g,b,m,r,t,n,C,o,a,s,u]),Z=(0,i.useCallback)(function(e){_({routeDef:(0,v.kN)({route:"builder",itemId:e,itemType:r,isTemplate:u}),method:"replace"})},[r,u,_]);return{createAndRouteToNewItem:(0,i.useCallback)(async function(){try{let e=await L();e&&Z(e.id)}catch(e){console.error(e)}},[L,Z])}},_=new Map([[c.o.Story,"component.storyCreator.creating"],[c.o.Frame,"component.frameCreator.creating"],[c.o.Briefing,"component.briefingCreator.creating"],[c.o.Collection,"component.collections.loading"],[c.o.Theme,"component.themeCreator.launchingThemeBuilder"]]);var C=(0,i.memo)(function(e){let t=(0,a.useRouter)(),{itemType:r}=e,{createAndRouteToNewItem:i}=b(e);(0,s.u)(function(){try{i()}catch(e){console.error(e)}});let c=t.pathname.includes("/templates")?"page.editTemplate.loading":_.get(r);return(0,n.jsx)(u.Z,{message:(0,n.jsx)(o.Z,{id:c})})})},65032:function(e,t,r){r.d(t,{gi:function(){return C},wz:function(){return b},Vx:function(){return w},j5:function(){return L},Az:function(){return Z},mA:function(){return T}});var n=r(552322);r(202784);var i=r(342670),o=r(348206),a=r(368667),s=r(293786),c=r(999354),u=r(398804),l=r(447878),m=r(278921),h=r(522532);let f=e=>window.performance.getEntriesByType("resource").filter(t=>"string"==typeof e?t.name===e:e.test(t.name));var p=r(81052),d=r(457945),v=r(936190);let y=e=>{let{baseThemeId:t}=e,{defaultBaseVariables:r}=(0,v.w8)(t),n={...r};return delete n.colorRamps,{baseThemeId:t,variables:n}};var g=r(612423);let w=async e=>{try{await (0,a.LZ)({isFavorite:!0,itemId:e.id,authManager:e.authManager,owner:e.owner}),e.toast.add({type:"success",title:(0,n.jsx)(i.Z,{id:"itemUtils.addFavorite.success"})})}catch(t){throw e.toast.add({type:"error",title:(0,n.jsx)(i.Z,{id:"builder.common.sorry"}),details:(0,n.jsx)(i.Z,{id:"itemUtils.addFavorite.error"})}),Error(t)}},T=async e=>{try{await (0,a.LZ)({isFavorite:!1,itemId:e.id,authManager:e.authManager,owner:e.owner}),e.toast.add({type:"success",title:(0,n.jsx)(i.Z,{id:"itemUtils.removeFavorite.success"})})}catch(t){throw e.toast.add({type:"error",title:(0,n.jsx)(i.Z,{id:"builder.common.sorry"}),details:(0,n.jsx)(i.Z,{id:"itemUtils.removeFavorite.error"})}),Error(t)}},b=async e=>{let t,r=(0,n.jsx)(i.Z,{id:"component.deleteItem.toast.title.permanent"});e.isRecycleBinEnabled&&!e.isPermanent&&(r=(0,n.jsx)(i.Z,{id:"component.deleteItem.toast.title.recoverable"}),t=(0,n.jsx)(i.Z,{id:"component.deleteItem.toast.description.recoverable"}));try{await (0,o.cl)({authentication:e.authManager,id:e.id,...e.owner&&{owner:e.owner},params:e.isPermanent?{permanentDelete:!0}:{}}),e.toast.add({type:"success",title:r,details:t})}catch(t){throw e.toast.add({type:"error",title:(0,n.jsx)(i.Z,{id:"builder.common.sorry"}),details:(0,n.jsx)(i.Z,{id:"itemUtils.errorDeleting.item"})}),Error(t)}},_=e=>{switch(e.itemType){case s.o.Story:{if(e.isTemplate){c.Z.trackEvent(c.Z.Category.Story,c.Z.Action.Story_CreateNewStoryTemplate);break}let t={sidecar:c.Z.Name.QuickStartTemplate_Sidecar,"guided-tour":c.Z.Name.QuickStartTemplate_GuidedTour,explorer:c.Z.Name.QuickStartTemplate_Explorer},r=(0,g.so)(e.templateForStory)?t[e.templateForStory]:c.Z.Name.QuickStartTemplate_Default;r&&c.Z.trackEvent(c.Z.Category.Story,c.Z.Action.Story_CreateNewStory,r),e.hasThemeForStory&&c.Z.trackEvent(c.Z.Category.Story,c.Z.Action.Story_CreateNewStoryWithTheme);break}case s.o.Briefing:c.Z.trackEvent(c.Z.Category.Briefing,c.Z.Action.Briefing_CreateBriefing);break;case s.o.Frame:c.Z.trackEvent(c.Z.Category.Frame,c.Z.Action.Frame_CreateFrame);break;case s.o.Collection:c.Z.trackEvent(c.Z.Category.Collection,c.Z.Action.Collection_CreateCollection);break;case s.o.Theme:c.Z.trackEvent(c.Z.Category.Theme,c.Z.Action.Theme_CreateNewTheme)}},C=async e=>{let t=await (0,u.uX)(e.authManager),r=await (0,d.mI)(e.config.BASE_URL),n=await e.authManager.getUser(),i=await (0,o.fC)({authentication:e.authManager,params:{thumbnail:r},item:(0,d.rV)({itemType:e.itemType,config:e.config,isPublicUser:t,orgId:n.orgId,isTemplate:e.isTemplate})}),a=(()=>{switch(e.itemType){case s.o.Story:return(0,d.U_)({firstName:n.firstName,lastName:n.lastName,title:e.title,theme:e.theme,baseThemeId:e.baseThemeId,webmap:e.webmap,webscene:e.webscene,template:e.template,shouldIncludeAuthorCard:e.featureDecisions.canUseAuthorCard,coverType:e.config.INCLUDED_STORY_COVERS[0],isTemplate:e.isTemplate});case s.o.Briefing:return(0,d.zb)({firstName:n.firstName,lastName:n.lastName,title:e.title,theme:e.theme,baseThemeId:e.baseThemeId,coverType:e.config.INCLUDED_STORY_COVERS[0]});case s.o.Frame:return(0,d.Fn)(e.config.BASE_URL);case s.o.Collection:return(0,d.$U)({firstName:n.firstName,lastName:n.lastName,title:e.title,theme:e.theme,baseThemeId:e.baseThemeId});case s.o.Theme:return y({baseThemeId:e.baseThemeId});default:return{}}})();return e.itemType===s.o.Story&&e.theme&&(await (0,o.bV)({originItemId:e.theme,destinationItemId:i.id,relationshipType:l.t4,authentication:e.authManager}),c.Z.trackEvent(c.Z.Category.Theme,c.Z.Action.Theme_AddRelationshipTheme2Story)),await (0,o.zJ)({authentication:e.authManager,id:i.id,name:"draft.json",resource:(0,m.ds)(a),owner:e.authManager.username,private:!0}),e.itemType===s.o.Story?_({itemType:e.itemType,templateForStory:e.template,hasThemeForStory:!!e.theme,isTemplate:e.isTemplate}):_({itemType:e.itemType,isTemplate:e.isTemplate}),i},L=e=>{let{storyUrl:t,getUrlFromRouteDef:r}=e;return r({route:"report-abuse",storyUrl:(0,h.w3)(t||window.location.href,["play","speed","cover","header"])})},Z=e=>{let{itemId:t,portalHost:r,authManager:n,customTracker:i}=e;try{let e=f(RegExp(`sharing/rest/content/items/${t}/data`)),a=window.performance.now(),s=e.reduce((e,t)=>{let r=a-t.startTime;return Math.min(r,e)},1/0);if(0===e.length||isFinite(s)&&s>9999){let e=()=>{(0,o.m_)(t,{authentication:n,portal:(0,p.Zl)(r,n)}),i?.()};"requestIdleCallback"in window?window.requestIdleCallback(e,{timeout:3e3}):setTimeout(e,3e3)}}catch{}}},794975:function(e,t,r){r.d(t,{u:function(){return i}});var n=r(202784);let i=(e,t,r)=>{let i=(0,n.useRef)(!1);return(0,n.useEffect)(()=>{if(!1===i.current){if(e(),r)return;i.current=!0}return t},[e,t,r]),i}}}]);